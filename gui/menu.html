<!doctype html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Phantom</title>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Roboto:300,400,700,900i"
    />
    <script>
      if (typeof module === "object") {
        window.module = module;
        module = undefined;
      }
    </script>

    <script src="js/vendor/jquery.js?v=1.0.3.10"></script>
    <script src="js/vendor/jquery_ui.js?v=1.0.3.10"></script>
    <link rel="stylesheet" href="fonts/fonts.css?v=1.0.3.10" />

    <link rel="stylesheet" type="text/css" href="main.css?v=1.0.3.10" />
    <link rel="stylesheet" href="vendor/bootstrap.min.css?v=1.0.3.10" />
    <link rel="stylesheet" href="fontawesome/fontawesome-all.css?v=1.0.3.10" />
    <script>
      if (window.module) module = window.module;
    </script>
  </head>

  <body id="app">
    <div id="particles-js"></div>
    <div class="top-titlebar" id="top-titlebar">
      <!--Main Navbar Underlay-->
      <nav
        class="navbar navbar-expand-sm navbar-dark pink draggable"
        data-tauri-drag-region
      >
        <div class="collapse navbar-collapse"></div>
      </nav>

      <!--Main Navbar-->
      <nav
        class="navbar navbar-expand-sm navbar-dark z-index-top absolute-position draggable"
        data-tauri-drag-region
      >
        <div class="collapse navbar-collapse">
          <ul class="navbar-nav z-index-top">
            <li class="nav-item active">
              <a class="nav-link" data-page="createTasksPage">
                <i class="fal fa-tasks"></i> Create Tasks
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-page="viewTasksPage">
                <i class="fal fa-bars"></i> View Tasks
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-page="accountsPage">
                <i class="fal fa-key"></i> Accounts
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-page="skillsPage">
                <i class="fal fa-magic"></i> Skills
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-page="analyticsPage">
                <i class="fal fa-clipboard-check"></i> Analytics
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-page="reviewPage">
                <i class="fal fa-code-merge"></i> Review
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-page="commandPage">
                <i class="fal fa-terminal"></i> Command
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-page="notesPage">
                <i class="fal fa-microphone-alt"></i> Notes
              </a>
            </li>
          </ul>
          <ul class="navbar-nav ml-auto">
            <li class="nav-item mt-2 mr-0">
              <a
                class="nav-link pb-0 pr-0 pt-2 mt-1 white-text"
                id="minimize-icon"
              >
                <i class="fal fa-fw fa-lg fa-minus"></i>
              </a>
            </li>
            <li class="nav-item mr-0">
              <a class="nav-link mt-1 pb-0 white-text" data-page="settingsPage">
                <i class="fal fa-cog"></i>
              </a>
            </li>
            <li class="nav-item mt-1 ml-2 mr-0">
              <a class="nav-link white-text pl-0" id="close-icon">
                <i class="fal fa-fw fa-lg fa-times"></i>
              </a>
            </li>
          </ul>
        </div>
      </nav>
    </div>
    <div class="content-container">
      <!--Create Tasks Page-->
      <section
        id="createTasksPage"
        class="create-tasks-page page container-fluid"
      >
        <div class="row no-gutters">
          <!--Upcoming Releases-->
          <div class="col-12">
            <div class="card mt-4 mr-4 ml-4">
              <div class="card-body pb-3">
                <div class="container-fluid p-0">
                  <div class="row">
                    <div class="col-12">
                      <h5 class="mb-3">Select an agent</h5>
                    </div>
                    <div class="col-12">
                      <div class="agent-select-grid">
                        <button
                          class="agent-card selected"
                          data-agent-id="codex"
                          data-agent-name="Codex"
                          type="button"
                        >
                          <svg class="agent-icon" role="img" aria-label="Codex">
                            <use
                              href="images/chatgpt-sprites-core.svg#55180d"
                            ></use>
                          </svg>
                        </button>
                        <button
                          class="agent-card"
                          data-agent-id="claude-code"
                          data-agent-name="Claude Code"
                          type="button"
                        >
                          <img src="images/claude-color.png" alt="Claude Code" />
                        </button>
                        <button
                          class="agent-card"
                          data-agent-id="amp"
                          data-agent-name="Amp"
                          type="button"
                        >
                          <span class="beta-badge" aria-hidden="true">Beta</span>
                          <img src="images/ampcode.png" alt="Amp" />
                        </button>
                        <button
                          class="agent-card"
                          data-agent-id="droid"
                          data-agent-name="Droid"
                          type="button"
                        >
                          <span class="beta-badge" aria-hidden="true">Beta</span>
                          <img src="images/factorydroid.png" alt="Droid" />
                        </button>
                        <button
                          class="agent-card"
                          data-agent-id="opencode"
                          data-agent-name="OpenCode"
                          type="button"
                        >
                          <span class="beta-badge" aria-hidden="true">Beta</span>
                          <img src="images/opencode.png" alt="OpenCode" />
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!--Create Task-->
          <div class="col-12">
            <div class="card mt-0 mr-4 mb-0 ml-4">
              <div class="card-body pb-3">
                <div class="container-fluid p-0">
                  <div class="row">
                    <div class="col-12">
                      <h5 class="mb-3">Create tasks</h5>
                    </div>
                    <div class="col-7">
                      <div class="form-group mb-3 prompt-container">
                        <div
                          class="form-control agent-prompt"
                          id="initialPrompt"
                          contenteditable="true"
                          data-placeholder="New task"
                          autofocus
                        ></div>
                        <div class="prompt-hint text-muted">
                          <kbd>CMD+V</kbd> to paste images inline
                        </div>
                        <!-- Image attachments toolbar -->
                        <div class="attachment-toolbar mt-2">
                          <input
                            type="file"
                            id="attachmentInput"
                            accept="image/jpeg,image/png,image/gif,image/webp"
                            multiple
                            style="display: none"
                          />
                          <button
                            type="button"
                            class="btn btn-sm btn-outline-secondary"
                            id="attachImageBtn"
                            title="Attach images (JPEG, PNG, GIF, WebP)"
                          >
                            <i class="fas fa-image"></i> Attach Image
                          </button>
                          <span class="attachment-hint text-muted ml-2">
                            or paste from clipboard
                          </span>
                        </div>
                        <!-- Hidden container for storing attachment metadata -->
                        <div
                          id="attachmentPreview"
                          class="attachment-preview mt-2"
                          style="display: none;"
                        ></div>
                      </div>
                      <div class="form-row">
                        <div class="form-group col-4" id="permissionModeGroup">
                          <label class="muted-label">Permission Mode</label>
                          <div id="permissionModeDropdown" class="custom-dropdown-wrapper"></div>
                        </div>
                        <div class="form-group col-4">
                          <label class="muted-label">Model</label>
                          <div id="execModelDropdown" class="custom-dropdown-wrapper"></div>
                        </div>
                        <div class="form-group col-4" id="planModeGroup">
                          <label class="muted-label">Plan Mode</label>
                          <div
                            class="toggle-buttons"
                            data-toggle="plan-mode"
                          >
                            <button
                              class="toggle-button"
                              type="button"
                              data-value="false"
                            >
                              Off
                            </button>
                            <button
                              class="toggle-button"
                              type="button"
                              data-value="true"
                            >
                              On
                            </button>
                            <input
                              type="checkbox"
                              id="planModeToggle"
                            />
                          </div>
                        </div>
                        <div class="form-group col-4" id="reasoningEffortGroup" style="display: none;">
                          <label class="muted-label">Thinking Level</label>
                          <div id="reasoningEffortDropdown" class="custom-dropdown-wrapper"></div>
                        </div>
                      </div>
                    </div>
                    <div class="col-5">
                      <div class="form-group mb-3">
                        <label class="muted-label" for="projectPath"
                          >Project</label
                        >
                        <div class="input-group project-picker">
                          <input
                            type="text"
                            class="form-control"
                            id="projectPath"
                            placeholder="/path/to/project"
                          />
                          <div class="input-group-append">
                            <button
                              class="btn btn-default btn-brand btn-sm"
                              id="pickProjectPath"
                            >
                              Browse
                            </button>
                          </div>
                        </div>
                      </div>
                      <div class="form-group mb-3">
                        <label class="muted-label">Base Branch</label>
                        <div id="baseBranchDropdown" class="custom-dropdown-wrapper"></div>
                      </div>
                      <div class="form-group mb-3">
                        <label class="muted-label">Context</label>
                        <div id="contextDropdown" class="custom-dropdown-wrapper"></div>
                      </div>
                      <div class="settings-stack">
                        <div class="setting-row">
                          <div class="setting-label">
                            Use Worktree
                          </div>
                          <div
                            class="toggle-buttons"
                            data-toggle="use-worktree"
                          >
                            <button
                              class="toggle-button"
                              type="button"
                              data-value="false"
                            >
                              Off
                            </button>
                            <button
                              class="toggle-button"
                              type="button"
                              data-value="true"
                            >
                              On
                            </button>
                            <input
                              type="checkbox"
                              id="useWorktreeToggle"
                              checked
                            />
                          </div>
                        </div>
                        <div id="worktreeMultiHint" class="worktree-multi-hint text-muted" style="display: none;">
                          Multi-agent runs always use a worktree.
                        </div>
                        <div class="setting-row" id="claudeDockerRow" style="display: none;">
                          <div class="setting-label">
                            Claude Runtime
                          </div>
                          <div
                            class="toggle-buttons"
                            data-toggle="claude-runtime"
                          >
                            <button
                              class="toggle-button"
                              type="button"
                              data-value="false"
                            >
                              Native
                            </button>
                            <button
                              class="toggle-button"
                              type="button"
                              data-value="true"
                            >
                              Docker
                            </button>
                            <input
                              type="checkbox"
                              id="claudeDockerToggle"
                            />
                          </div>
                        </div>

                        <div class="setting-row">
                          <div class="setting-label">
                            Schedule Task
                          </div>
                          <div class="task-scheduler-inline">
                            <button class="btn btn-outline-secondary btn-sm" id="taskSchedulerOpenBtn" type="button">
                              <i class="fal fa-plus"></i> New
                            </button>
                            <span class="task-scheduler-inline-meta" id="taskSchedulerInlineMeta">No schedules</span>
                          </div>
                        </div>
                      </div>

                      <div class="form-group mb-0 mt-3">
                        <a
                          id="createAgentButton"
                          class="btn btn-default btn-sm btn-brand btn-fill"
                        >
                          Create Task
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
      <!--View Tasks Page-->
      <section
        id="viewTasksPage"
        class="view-tasks-page page container-fluid"
        hidden
      >
        <div class="row no-gutters">
          <!-- Global Actions -->
          <div class="col-12">
            <div class="card mt-4 mr-4 ml-4">
              <div class="card-body pb-3">
                <div class="container-fluid p-0">
                  <div class="row no-gutters">
                    <div class="col-12">
                      <h5 class="mb-3">Global actions</h5>
                    </div>
                    <div class="col-12 mb-2 mt-2">
                      <a
                        id="globalStartTasks"
                        class="btn btn-success btn-sm mr-2"
                        >Start all</a
                      >
                      <a
                        id="globalStopTasks"
                        class="btn btn-warning btn-sm mr-2"
                        >Stop all</a
                      >
                      <a
                        id="globalDeleteTasks"
                        class="btn btn-danger btn-sm mr-2"
                        >Delete all</a
                      >
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- View Tasks -->
          <div class="col-12">
            <div class="card mt-0 mr-4 mb-0 ml-4">
              <div class="card-body pb-3">
                <div class="container-fluid p-0">
                  <div class="row">
                    <div class="col-12 view-tasks-table-container scrollable">
                      <table class="table table-sm borderless sortable-table">
                        <colgroup>
                          <col width="5%" />
                          <!--ID-->
                          <col width="5%" />
                          <!--AGENT-->
                          <col width="18%" />
                          <!--MODEL-->
                          <col width="18%" />
                          <!--WORKTREE-->
                          <col width="25%" />
                          <!--STATUS-->
                          <col width="6%" />
                          <!--CTX-->
                          <col width="8%" />
                          <!--COST-->
                          <col width="15%" />
                          <!--ACTIONS-->
                        </colgroup>
                        <thead>
                          <tr>
                            <th scope="col" class="sortable" data-sort="id">
                              ID
                            </th>
                            <th scope="col" class="sortable" data-sort="agent">
                              AGENT
                            </th>
                            <th scope="col" class="sortable" data-sort="model">
                              MODEL
                            </th>
                            <th scope="col" class="sortable" data-sort="worktree">
                              WORKTREE
                            </th>
                            <th scope="col" class="sortable" data-sort="status">
                              STATUS
                            </th>
                            <th scope="col" title="Context window usage">
                              CTX
                            </th>
                            <th scope="col" class="sortable" data-sort="cost">
                              COST
                            </th>
                            <th scope="col">ACTIONS</th>
                          </tr>
                        </thead>
                        <tbody id="tasks-table"></tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
      <!-- Account Lists -->
      <section
        id="accountsPage"
        class="accounts-page page container-fluid"
        hidden
      >
        <div class="row no-gutters">
          <div class="col-12">
            <div class="card mt-4 mr-4 mb-4 ml-4 account-shell">
              <div class="card-body">
                <div class="accounts-header">
                  <div>
                    <h5 class="mb-1">Agent Accounts</h5>
                    <p class="muted-text">
                      Connect Codex and Claude Code with subscription login or
                      API keys.
                    </p>
                  </div>
                  <div class="accounts-actions">
                    <button
                      class="btn btn-default btn-brand btn-sm"
                      data-auth-save
                    >
                      Save Credentials
                    </button>
                  </div>
                </div>
                <div class="accounts-grid">
                  <div class="auth-card codex">
                    <div class="auth-card-header">
                      <div class="auth-brand">
                        <svg class="auth-icon" role="img" aria-label="Codex">
                          <use
                            href="images/chatgpt-sprites-core.svg#55180d"
                          ></use>
                        </svg>
                        <div>
                          <div class="auth-title">ChatGPT Codex</div>
                          <div class="auth-sub" data-auth-status="codex">
                            Not connected
                          </div>
                        </div>
                      </div>
                      <!-- Inline Usage Tracker -->
                      <div
                        class="usage-inline"
                        data-usage-tracker="codex"
                        hidden
                      >
                        <div
                          class="usage-inline-meter"
                          data-usage-meter="session"
                        >
                          <div class="usage-inline-label">
                            <span class="usage-inline-name">Session</span>
                            <span
                              class="usage-inline-percent"
                              data-usage-percent="session"
                              >--%</span
                            >
                          </div>
                          <div class="usage-inline-bar">
                            <div
                              class="usage-inline-fill"
                              data-usage-fill="session"
                              style="width: 0%"
                            ></div>
                          </div>
                          <span
                            class="usage-inline-reset"
                            data-usage-reset="session"
                            >5h window</span
                          >
                        </div>
                        <div
                          class="usage-inline-meter"
                          data-usage-meter="weekly"
                        >
                          <div class="usage-inline-label">
                            <span class="usage-inline-name">Weekly</span>
                            <span
                              class="usage-inline-percent"
                              data-usage-percent="weekly"
                              >--%</span
                            >
                          </div>
                          <div class="usage-inline-bar">
                            <div
                              class="usage-inline-fill weekly"
                              data-usage-fill="weekly"
                              style="width: 0%"
                            ></div>
                          </div>
                          <span
                            class="usage-inline-reset"
                            data-usage-reset="weekly"
                            >7d window</span
                          >
                        </div>
                      </div>
                    </div>
                    <div class="auth-body">
                      <div class="codex-accounts">
                        <div class="codex-accounts-header">
                          <div class="codex-accounts-title">Accounts</div>
                          <button
                            class="btn codex-add-btn"
                            data-codex-account-add
                          >
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                              <line x1="12" y1="5" x2="12" y2="19"></line>
                              <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            Add
                          </button>
                        </div>
                        <div id="codexAccountsList" class="codex-accounts-list"></div>
                      </div>
                      <label class="muted-label"
                        >OpenAI API key (OPENAI_API_KEY)</label
                      >
                      <input
                        type="password"
                        class="form-control auth-input"
                        data-auth-key="openaiApiKey"
                        placeholder="sk-..."
                      />
                      <div class="auth-footer">
                        <p class="auth-help">
                          ChatGPT subscription login uses your existing ChatGPT
                          plan.
                        </p>
                        <button
                          class="btn btn-default btn-sm btn-brand auth-login"
                          data-auth-action="codex-login"
                        >
                          Sign in with ChatGPT
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="auth-card claude">
                    <div class="auth-card-header">
                      <div class="auth-brand">
                        <img src="images/claude-color.png" alt="Claude Code" />
                        <div>
                          <div class="auth-title">Claude Code</div>
                          <div class="auth-sub" data-auth-status="claude">
                            Not connected
                          </div>
                          <div
                            class="auth-email-wrapper"
                            hidden
                            data-auth-email-wrapper="claude"
                          >
                            <span
                              class="auth-email redacted"
                              data-auth-email="claude"
                            ></span>
                            <button
                              type="button"
                              class="auth-email-toggle"
                              data-toggle-email="claude"
                              title="Show email"
                            >
                              <svg
                                class="eye-icon"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                              >
                                <path
                                  class="eye-open"
                                  d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"
                                ></path>
                                <circle
                                  class="eye-open"
                                  cx="12"
                                  cy="12"
                                  r="3"
                                ></circle>
                                <path
                                  class="eye-closed"
                                  d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"
                                  style="display: none"
                                ></path>
                                <line
                                  class="eye-closed"
                                  x1="1"
                                  y1="1"
                                  x2="23"
                                  y2="23"
                                  style="display: none"
                                ></line>
                              </svg>
                            </button>
                          </div>
                        </div>
                      </div>
                      <!-- Keychain Permission Button (shown when usage unavailable) -->
                      <div
                        class="usage-keychain-prompt"
                        data-usage-keychain="claude"
                      >
                        <button
                          class="btn btn-sm btn-outline-secondary"
                          data-auth-action="claude-keychain"
                        >
                          <i class="fal fa-key"></i> Enable Usage Tracking
                        </button>
                        <span class="usage-keychain-hint"
                          >Requires Claude Code login</span
                        >
                      </div>
                      <!-- Inline Usage Tracker (hidden until permissions granted) -->
                      <div
                        class="usage-inline"
                        data-usage-tracker="claude"
                        hidden
                      >
                        <div
                          class="usage-inline-meter"
                          data-usage-meter-claude="session"
                        >
                          <div class="usage-inline-label">
                            <span class="usage-inline-name">Session</span>
                            <span
                              class="usage-inline-percent"
                              data-usage-percent-claude="session"
                              >--%</span
                            >
                          </div>
                          <div class="usage-inline-bar">
                            <div
                              class="usage-inline-fill"
                              data-usage-fill-claude="session"
                              style="width: 0%"
                            ></div>
                          </div>
                          <span
                            class="usage-inline-reset"
                            data-usage-reset-claude="session"
                            >5h window</span
                          >
                        </div>
                        <div
                          class="usage-inline-meter"
                          data-usage-meter-claude="weekly"
                        >
                          <div class="usage-inline-label">
                            <span class="usage-inline-name">Weekly</span>
                            <span
                              class="usage-inline-percent"
                              data-usage-percent-claude="weekly"
                              >--%</span
                            >
                          </div>
                          <div class="usage-inline-bar">
                            <div
                              class="usage-inline-fill weekly"
                              data-usage-fill-claude="weekly"
                              style="width: 0%"
                            ></div>
                          </div>
                          <span
                            class="usage-inline-reset"
                            data-usage-reset-claude="weekly"
                            >7d window</span
                          >
                        </div>
                      </div>
                    </div>
                    <div class="auth-body">
                      <label class="muted-label"
                        >Anthropic API key (ANTHROPIC_API_KEY)</label
                      >
                      <input
                        type="password"
                        class="form-control auth-input"
                        data-auth-key="anthropicApiKey"
                        placeholder="sk-ant-..."
                      />
                      <label class="muted-label auth-env-label"
                        >Claude Code environment variables</label
                      >
                      <textarea
                        class="form-control auth-input auth-env-input"
                        data-auth-key="claudeCodeEnv"
                        data-auth-allow-empty="true"
                        placeholder="# One KEY=VALUE per line&#10;# Example: AWS Bedrock&#10;AWS_REGION=us-east-1&#10;AWS_PROFILE=default&#10;# Or explicit credentials:&#10;AWS_ACCESS_KEY_ID=YOUR_ACCESS_KEY_ID&#10;AWS_SECRET_ACCESS_KEY=YOUR_SECRET_ACCESS_KEY&#10;AWS_SESSION_TOKEN=YOUR_SESSION_TOKEN&#10;# Or Bedrock API key auth:&#10;AWS_BEARER_TOKEN_BEDROCK=YOUR_BEDROCK_API_KEY"
                      ></textarea>
                      <div class="auth-env-hint">
                        Passed to the Claude Code CLI process. Comments starting with
                        <code>#</code> are ignored. Keys like
                        <code>ANTHROPIC_API_KEY</code> are managed above.
                      </div>
                      <div class="auth-footer">
                        <p class="auth-help">
                          Use CLI login or an API key for Claude Code.
                        </p>
                        <button
                          class="btn btn-default btn-sm btn-brand auth-login"
                          data-auth-action="claude-login"
                        >
                          Sign in to Claude Code
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="auth-footnote">
                  <span class="muted-text"
                    >Keys are stored locally in app settings.</span
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!--Skills-->
      <section
        id="skillsPage"
        class="skills-page page container-fluid"
        hidden
      >
        <div class="row no-gutters">
          <!-- Header Card with Tabs -->
          <div class="col-12">
            <div class="card mt-4 mr-4 ml-4">
              <div class="card-body pb-3">
                <div class="skills-page-header">
                  <div>
                    <h5 class="mb-1">Agent Skills</h5>
                    <p class="muted-text mb-0">
                      Skills are reusable instructions that extend agent capabilities. They are loaded from SKILL.md files.
                    </p>
                  </div>
                  <div class="skills-header-actions">
                    <a href="skills-tree.html" class="btn btn-default btn-sm btn-skill-tree" title="Open Skill Tree View">
                      <i class="fal fa-project-diagram"></i> Skill Tree
                    </a>
                    <button class="btn btn-default btn-brand btn-sm" id="refreshSkillsBtn">
                      <i class="fal fa-sync-alt"></i> Refresh
                    </button>
                    <button class="btn btn-default btn-sm btn-apply-skills" id="applySkillChangesBtn" style="display: none;" title="Restart agents to apply skill changes. This may take a few seconds.">
                      <i class="fal fa-bolt"></i> Apply Changes
                    </button>
                  </div>
                </div>

                <!-- Agent Skills Tabs -->
                <div class="skills-tabs mb-0">
                  <button class="skills-tab active" data-agent="codex">
                    <img src="images/codex.svg" alt="Codex" class="skills-tab-icon" style="filter: brightness(0) invert(1);" />
                    <span>Codex</span>
                    <span class="skills-tab-count" data-count="codex">0</span>
                  </button>
                  <button class="skills-tab" data-agent="claude-code">
                    <img src="images/claude-color.png" alt="Claude Code" class="skills-tab-icon" />
                    <span>Claude Code</span>
                    <span class="skills-tab-count" data-count="claude-code">0</span>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Personal Skills Card -->
          <div class="col-12">
            <div class="card mt-0 mr-4 ml-4">
              <div class="card-body pb-3">
                <div class="skills-content">
                  <div class="skills-panel" data-panel="codex">
                    <div class="skills-category mb-0">
                      <div class="skills-category-header">
                        <i class="fal fa-user"></i>
                        <span>Personal Skills</span>
                        <span class="skills-category-path">~/.codex/skills/</span>
                      </div>
                      <div class="skills-grid" data-skills="codex-personal"></div>
                    </div>
                  </div>
                  <div class="skills-panel" data-panel="claude-code" hidden>
                    <div class="skills-category mb-0">
                      <div class="skills-category-header">
                        <i class="fal fa-user"></i>
                        <span>Personal Skills</span>
                        <span class="skills-category-path">~/.claude/skills/, ~/.factory/skills/</span>
                      </div>
                      <div class="skills-grid" data-skills="claude-personal"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Project Skills Card -->
          <div class="col-12">
            <div class="card mt-0 mr-4 ml-4">
              <div class="card-body pb-3">
                <div class="skills-content">
                  <div class="skills-panel" data-panel="codex">
                    <div class="skills-category mb-0">
                      <div class="skills-category-header">
                        <i class="fal fa-folder"></i>
                        <span>Project Skills</span>
                        <span class="skills-category-path">.codex/skills/</span>
                      </div>
                      <div class="skills-grid" data-skills="codex-project"></div>
                    </div>
                  </div>
                  <div class="skills-panel" data-panel="claude-code" hidden>
                    <div class="skills-category mb-0">
                      <div class="skills-category-header">
                        <i class="fal fa-folder"></i>
                        <span>Project Skills</span>
                        <span class="skills-category-path">.claude/skills/, .factory/skills/</span>
                      </div>
                      <div class="skills-grid" data-skills="claude-project"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!--Analytics - Analytics Center-->
      <section
        id="analyticsPage"
        class="analytics-page page container-fluid"
        hidden
      >
        <div class="card mt-4 mr-4 mb-2 ml-4 analytics-header-card">
          <div class="card-body pb-3">
            <div class="container-fluid p-0">
              <div class="row no-gutters">
                <div class="col-12">
                  <h5 class="mb-2 analytics-title">Analytics Center</h5>
                </div>
                <div class="col-12">
                  <div class="phantom-time-range analytics-range">
                    <button class="phantom-range-btn active" data-range="7">7D</button>
                    <button class="phantom-range-btn" data-range="14">14D</button>
                    <button class="phantom-range-btn" data-range="30">30D</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Comparison Overview Cards -->
        <div class="phantom-comparison-grid">
          <!-- Codex Summary Card -->
          <div class="phantom-agent-card codex" data-agent="codex">
            <div class="agent-card-header">
              <div class="agent-identity">
                <svg class="agent-logo-icon" role="img" aria-label="Codex">
                  <use href="images/chatgpt-sprites-core.svg#55180d"></use>
                </svg>
                <div class="agent-name-group">
                  <span class="agent-name">Codex</span>
                  <span class="agent-source">~/.codex/sessions</span>
                </div>
              </div>
              <div class="agent-status-indicator online">
                <span class="status-dot"></span>
                <span class="status-text">Active</span>
              </div>
            </div>
            <div class="agent-stats-row" id="codexSummaryGrid">
              <div class="agent-stat">
                <span class="stat-value" data-stat="last7">--</span>
                <span class="stat-label" data-stat-label="totalTokens">Total Tokens (7D)</span>
              </div>
              <div class="agent-stat">
                <span class="stat-value" data-stat="last30">--</span>
                <span class="stat-label" data-stat-label="outputTokens">Output Tokens (7D)</span>
              </div>
              <div class="agent-stat highlight">
                <span class="stat-value" data-stat="cacheRate">--%</span>
                <span class="stat-label">Cache Rate</span>
              </div>
              <div class="agent-stat cost">
                <span class="stat-value" data-stat="totalCost">$--</span>
                <span class="stat-label" data-stat-label="totalCost">Est. Cost (7D)</span>
              </div>
            </div>
            <div class="agent-trend-indicator">
              <i class="fal fa-arrow-trend-up"></i>
              <span data-stat="peakDate">Peak: --</span>
            </div>
          </div>

          <!-- Claude Summary Card -->
          <div class="phantom-agent-card claude" data-agent="claude">
            <div class="agent-card-header">
              <div class="agent-identity">
                <img src="images/claude-color.png" alt="Claude Code" class="agent-logo-img" />
                <div class="agent-name-group">
                  <span class="agent-name">Claude Code</span>
                  <span class="agent-source">~/.claude/projects</span>
                </div>
              </div>
              <div class="agent-status-indicator online">
                <span class="status-dot"></span>
                <span class="status-text">Active</span>
              </div>
            </div>
            <div class="agent-stats-row" id="claudeSummaryGrid">
              <div class="agent-stat">
                <span class="stat-value" data-stat="last7">--</span>
                <span class="stat-label" data-stat-label="totalTokens">Total Tokens (7D)</span>
              </div>
              <div class="agent-stat">
                <span class="stat-value" data-stat="last30">--</span>
                <span class="stat-label" data-stat-label="outputTokens">Output Tokens (7D)</span>
              </div>
              <div class="agent-stat highlight">
                <span class="stat-value" data-stat="cacheRate">--%</span>
                <span class="stat-label">Cache Rate</span>
              </div>
              <div class="agent-stat cost">
                <span class="stat-value" data-stat="totalCost">$--</span>
                <span class="stat-label" data-stat-label="totalCost">Est. Cost (7D)</span>
              </div>
            </div>
            <div class="agent-trend-indicator">
              <i class="fal fa-arrow-trend-up"></i>
              <span data-stat="peakDate">Peak: --</span>
            </div>
          </div>
        </div>

        <!-- Detailed Stats Grid -->
        <div class="phantom-details-grid">
          <!-- Codex Detailed Stats -->
          <div class="phantom-detail-card" data-agent="codex">
            <div class="detail-card-header">
              <div class="detail-agent-badge codex">
                <svg class="detail-agent-icon" role="img"><use href="images/chatgpt-sprites-core.svg#55180d"></use></svg>
                <span>Codex Details</span>
              </div>
              <button class="detail-refresh-btn" id="refreshCodexAnalytics">
                <i class="fal fa-sync-alt"></i>
              </button>
            </div>

            <!-- Mini Bar Chart -->
            <div class="detail-mini-chart">
              <div class="mini-chart-title">Daily Usage</div>
              <div class="mini-bar-chart" id="codexBarChart">
                <div class="bar-container"><div class="bar" data-day="0" style="--bar-height: 0%"></div><span class="bar-label">--</span></div>
                <div class="bar-container"><div class="bar" data-day="1" style="--bar-height: 0%"></div><span class="bar-label">--</span></div>
                <div class="bar-container"><div class="bar" data-day="2" style="--bar-height: 0%"></div><span class="bar-label">--</span></div>
                <div class="bar-container"><div class="bar" data-day="3" style="--bar-height: 0%"></div><span class="bar-label">--</span></div>
                <div class="bar-container"><div class="bar" data-day="4" style="--bar-height: 0%"></div><span class="bar-label">--</span></div>
                <div class="bar-container"><div class="bar" data-day="5" style="--bar-height: 0%"></div><span class="bar-label">--</span></div>
                <div class="bar-container today"><div class="bar" data-day="6" style="--bar-height: 0%"></div><span class="bar-label">Today</span></div>
              </div>
            </div>

            <!-- Model Breakdown -->
            <div class="detail-breakdown">
              <div class="breakdown-title">Model Distribution</div>
              <div class="model-breakdown" id="codexModelBreakdown">
                <div class="breakdown-item">
                  <div class="breakdown-header">
                    <span class="breakdown-model">Loading...</span>
                    <span class="breakdown-percent">--%</span>
                  </div>
                  <div class="breakdown-bar"><div class="breakdown-fill" style="width: 0%"></div></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Claude Detailed Stats -->
          <div class="phantom-detail-card" data-agent="claude">
            <div class="detail-card-header">
              <div class="detail-agent-badge claude">
                <img src="images/claude-color.png" alt="Claude" class="detail-agent-img" />
                <span>Claude Details</span>
              </div>
              <button class="detail-refresh-btn" id="refreshClaudeAnalytics">
                <i class="fal fa-sync-alt"></i>
              </button>
            </div>

            <!-- Mini Bar Chart -->
            <div class="detail-mini-chart">
              <div class="mini-chart-title">Daily Usage</div>
              <div class="mini-bar-chart" id="claudeBarChart">
                <div class="bar-container"><div class="bar claude" data-day="0" style="--bar-height: 0%"></div><span class="bar-label">--</span></div>
                <div class="bar-container"><div class="bar claude" data-day="1" style="--bar-height: 0%"></div><span class="bar-label">--</span></div>
                <div class="bar-container"><div class="bar claude" data-day="2" style="--bar-height: 0%"></div><span class="bar-label">--</span></div>
                <div class="bar-container"><div class="bar claude" data-day="3" style="--bar-height: 0%"></div><span class="bar-label">--</span></div>
                <div class="bar-container"><div class="bar claude" data-day="4" style="--bar-height: 0%"></div><span class="bar-label">--</span></div>
                <div class="bar-container"><div class="bar claude" data-day="5" style="--bar-height: 0%"></div><span class="bar-label">--</span></div>
                <div class="bar-container today"><div class="bar claude" data-day="6" style="--bar-height: 0%"></div><span class="bar-label">Today</span></div>
              </div>
            </div>

            <!-- Model Breakdown -->
            <div class="detail-breakdown">
              <div class="breakdown-title">Model Distribution</div>
              <div class="model-breakdown" id="claudeModelBreakdown">
                <div class="breakdown-item">
                  <div class="breakdown-header">
                    <span class="breakdown-model">Loading...</span>
                    <span class="breakdown-percent">--%</span>
                  </div>
                  <div class="breakdown-bar"><div class="breakdown-fill claude" style="width: 0%"></div></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Comparison Metrics -->
          <div class="phantom-detail-card metrics-card">
            <div class="detail-card-header">
              <div class="detail-agent-badge metrics">
                <i class="fal fa-chart-mixed"></i>
                <span>Head-to-Head</span>
              </div>
            </div>

            <div class="comparison-metrics" id="comparisonMetrics">
              <div class="metric-row">
                <span class="metric-label" data-metric-label="totalTokens">Total Tokens (7D)</span>
                <div class="metric-bar-wrapper">
                  <div class="metric-bar-track">
                    <div class="metric-bar-fill codex" id="codex7dBar" style="width: 50%"></div>
                    <div class="metric-bar-fill claude" id="claude7dBar" style="width: 50%"></div>
                  </div>
                </div>
                <div class="metric-values">
                  <span class="metric-val codex" id="codex7dVal">--</span>
                  <span class="metric-vs">vs</span>
                  <span class="metric-val claude" id="claude7dVal">--</span>
                </div>
              </div>

              <div class="metric-row">
                <span class="metric-label">Cache Efficiency</span>
                <div class="metric-bar-wrapper">
                  <div class="metric-bar-track">
                    <div class="metric-bar-fill codex" id="codexCacheBar" style="width: 50%"></div>
                    <div class="metric-bar-fill claude" id="claudeCacheBar" style="width: 50%"></div>
                  </div>
                </div>
                <div class="metric-values">
                  <span class="metric-val codex" id="codexCacheVal">--%</span>
                  <span class="metric-vs">vs</span>
                  <span class="metric-val claude" id="claudeCacheVal">--%</span>
                </div>
              </div>

              <div class="metric-row">
                <span class="metric-label">Daily Average</span>
                <div class="metric-bar-wrapper">
                  <div class="metric-bar-track">
                    <div class="metric-bar-fill codex" id="codexAvgBar" style="width: 50%"></div>
                    <div class="metric-bar-fill claude" id="claudeAvgBar" style="width: 50%"></div>
                  </div>
                </div>
                <div class="metric-values">
                  <span class="metric-val codex" id="codexAvgVal">--</span>
                  <span class="metric-vs">vs</span>
                  <span class="metric-val claude" id="claudeAvgVal">--</span>
                </div>
              </div>

              <div class="winner-badge" id="winnerBadge">
                <i class="fal fa-trophy"></i>
                <span>Most Active: <strong id="winnerName">--</strong></span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!--Review Center-->
      <section id="reviewPage" class="review-page page container-fluid" hidden>
        <div class="row no-gutters">
          <div class="col-12">
            <div class="card mt-4 mr-4 ml-4 review-header-card">
              <div class="card-body">
                <div class="review-header-content">
                  <div class="review-header-title">
                    <div class="review-icon-wrap">
                      <i class="fal fa-code-merge"></i>
                    </div>
                    <div class="review-title-text">
                      <h5 class="review-title">Review Center</h5>
                      <p class="review-subtitle">Inspect diffs and leave notes before merging</p>
                    </div>
                  </div>
                  <div class="review-header-actions-right">
                    <button type="button" class="review-icon-btn" id="reviewRefreshBtn" title="Refresh">
                      <i class="fal fa-sync-alt"></i>
                    </button>
                    <button type="button" class="review-icon-btn" id="reviewOpenWorktreeBtn" disabled title="Open in Finder">
                      <i class="fal fa-folder-open"></i>
                    </button>
                  </div>
                </div>
                <div class="review-controls-bar">
                  <div class="review-selectors">
                    <div class="review-selector-group">
                      <label class="review-selector-label">Project</label>
                      <div id="reviewProjectSelector" class="custom-dropdown-wrapper"></div>
                    </div>
                    <div class="review-selector-group review-selector-task">
                      <label class="review-selector-label">Task</label>
                      <div id="reviewTaskSelector" class="custom-dropdown-wrapper"></div>
                    </div>
                  </div>
                  <div class="review-compare-section">
                    <label class="review-selector-label">Compare</label>
                    <div class="review-toggle-group" id="reviewCompareToggle">
                      <button type="button" class="review-toggle-btn active" data-compare="main">
                        <i class="fal fa-code-branch"></i>
                        <span>vs Main</span>
                      </button>
                      <button type="button" class="review-toggle-btn" data-compare="base">
                        <i class="fal fa-layer-group"></i>
                        <span>vs Base</span>
                      </button>
                      <button type="button" class="review-toggle-btn" data-compare="history">
                        <i class="fal fa-history"></i>
                        <span>History</span>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="col-12">
            <div class="review-grid">
              <div class="review-panel review-files">
                <div class="review-panel-header">
                  <span>Changed files</span>
                  <span class="review-badge" id="reviewFileCount">0</span>
                </div>
                <div class="review-panel-body scrollable" id="reviewFileList">
                  <div class="review-empty" id="reviewFilesEmpty">
                    Select a task to load diffs.
                  </div>
                </div>
              </div>

              <div class="review-panel review-diff">
                <div class="review-panel-header review-diff-header">
                  <div class="review-diff-path" id="reviewDiffPath">
                    <i class="fal fa-file-code"></i>
                    <span>Select a file</span>
                  </div>
                  <div class="review-diff-actions">
                    <button type="button" class="review-action-btn" data-view="unified" id="reviewUnifiedBtn">
                      <i class="fal fa-compress-alt"></i> Unified
                    </button>
                    <button type="button" class="review-action-btn active" data-view="split" id="reviewSplitBtn">
                      <i class="fal fa-columns"></i> Split
                    </button>
                    <button type="button" class="review-action-btn" id="reviewCommentBtn" disabled>
                      <i class="fal fa-comment-plus"></i> Comment
                    </button>
                    <button type="button" class="review-action-btn review-approve" id="reviewApproveBtn" disabled>
                      <i class="fal fa-check"></i> Approve
                    </button>
                  </div>
                </div>

                <div class="review-diff-body" id="reviewDiffBody">
                  <div class="review-diff-placeholder">No diff loaded.</div>
                </div>
              </div>
            </div>
          </div>

          <div class="col-12">
            <div class="card mt-2 mr-4 mb-4 ml-4 review-timeline-card">
              <div class="card-body">
                <div class="review-timeline-header">
                  <div class="review-timeline-title">
                    <i class="fal fa-code-commit"></i>
                    Commit timeline
                  </div>
                  <div class="review-timeline-meta" id="reviewTimelineMeta">0 commits  0 comments</div>
                </div>
                <div class="review-timeline-track" id="reviewTimelineTrack">
                  <div class="review-empty">Timeline coming soon.</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!--Command Center-->
      <section id="commandPage" class="command-page page container-fluid" hidden>
        <!-- Header -->
        <div class="command-header">
          <h5 class="command-title">
            <i class="fal fa-terminal"></i>
            Command Center
          </h5>
          <div class="command-header-actions">
            <button class="command-header-btn" id="commandRefreshBtn">
              <i class="fal fa-sync-alt"></i> Refresh
            </button>
            <button class="command-header-btn" id="commandConfigureBtn">
              <i class="fal fa-cog"></i> Configure
            </button>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="command-quick-actions-row">
          <span class="command-quick-actions-label">Quick Actions</span>
          <div class="command-quick-action" id="quickFixTopError">
            <div class="command-quick-action-icon sentry">
              <i class="fal fa-bug"></i>
            </div>
            <div class="command-quick-action-text">
              <div class="command-quick-action-title">Fix Top Error</div>
              <div class="command-quick-action-desc" id="quickFixTopErrorDesc">No errors detected</div>
            </div>
            <i class="fal fa-arrow-right command-quick-action-arrow"></i>
          </div>
          <div class="command-quick-action" id="quickStartNextIssue">
            <div class="command-quick-action-icon linear">
              <i class="fal fa-ticket"></i>
            </div>
            <div class="command-quick-action-text">
              <div class="command-quick-action-title">Start Next Issue</div>
              <div class="command-quick-action-desc" id="quickStartNextIssueDesc">No issues assigned</div>
            </div>
            <i class="fal fa-arrow-right command-quick-action-arrow"></i>
          </div>
          <div class="command-quick-action" id="quickRerunFailedCI">
            <div class="command-quick-action-icon ci">
              <i class="fal fa-redo"></i>
            </div>
            <div class="command-quick-action-text">
              <div class="command-quick-action-title">Re-run Failed CI</div>
              <div class="command-quick-action-desc" id="quickRerunFailedCIDesc">All builds passing</div>
            </div>
            <i class="fal fa-arrow-right command-quick-action-arrow"></i>
          </div>
        </div>

        <!-- Main Grid -->
        <div class="command-grid">
          <!-- Linear Issues Panel -->
          <div class="command-panel">
            <div class="command-panel-header">
              <span class="command-panel-title">
                <span class="command-logo-linear"></span>
                Linear Issues
              </span>
              <span class="command-panel-badge command-badge-purple" id="linearIssueCount">0 active</span>
            </div>
            <div class="command-panel-content" id="linearIssuesList">
              <div class="command-empty-state">
                <i class="fal fa-ticket"></i>
                <p>No issues assigned</p>
                <small>Connect Linear to see your issues</small>
              </div>
            </div>
          </div>

          <!-- Sentry Errors Panel -->
          <div class="command-panel">
            <div class="command-panel-header">
              <span class="command-panel-title">
                <span class="command-logo-sentry"></span>
                Sentry Errors
              </span>
              <span class="command-panel-badge command-badge-orange" id="sentryErrorCount">0 unresolved</span>
            </div>
            <div class="command-panel-content" id="sentryErrorsList">
              <div class="command-empty-state">
                <i class="fal fa-bug"></i>
                <p>No unresolved errors</p>
                <small>Connect Sentry to see errors</small>
              </div>
            </div>
          </div>

          <!-- CI/CD Status Panel -->
          <div class="command-panel">
            <div class="command-panel-header">
              <span class="command-panel-title">
                <i class="fab fa-github command-icon-ci"></i>
                CI / CD
              </span>
              <span class="command-panel-badge command-badge-green" id="ciStatusCount">0 running</span>
            </div>
            <div class="command-panel-content" id="ciStatusList">
              <div class="command-empty-state">
                <i class="fal fa-code-branch"></i>
                <p>No recent workflows</p>
                <small>Connect GitHub to see CI status</small>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Agent Task Popup (for Command Center) -->
      <div class="command-agent-popup-backdrop" id="commandAgentPopupBackdrop" hidden></div>
      <div class="command-agent-popup" id="commandAgentPopup" hidden>
        <div class="command-agent-popup-header">
          <span class="command-agent-popup-title">
            <i class="fal fa-robot"></i>
            Create Fix Task
          </span>
          <button class="command-agent-popup-close" id="commandAgentPopupClose">
            <i class="fal fa-times"></i>
          </button>
        </div>
        <div class="command-agent-popup-body">
          <div class="command-agent-error-preview" id="commandAgentErrorPreview">
            <div class="command-agent-error-title" id="commandAgentErrorTitle">Error</div>
            <div class="command-agent-error-file" id="commandAgentErrorFile">file.ts:0  0 events</div>
          </div>
          <div class="command-agent-select-label">Select an agent</div>
          <div class="command-agent-select-grid">
            <div class="command-agent-option selected" data-agent="claude-code">
              <img src="images/claude-color.png" alt="Claude" onerror="this.style.display='none'">
              <span class="command-agent-option-name">Claude</span>
            </div>
            <div class="command-agent-option" data-agent="codex">
              <img src="images/codex.svg" alt="Codex">
              <span class="command-agent-option-name">Codex</span>
            </div>
            <div class="command-agent-option" data-agent="amp">
              <img src="images/ampcode.png" alt="Amp" onerror="this.style.display='none'">
              <span class="command-agent-option-name">Amp</span>
            </div>
          </div>
          <textarea class="command-agent-prompt-input" id="commandAgentPromptInput" placeholder="Additional context..."></textarea>
          <div class="command-agent-popup-actions">
            <button class="command-agent-btn cancel" id="commandAgentCancelBtn">Cancel</button>
            <button class="command-agent-btn create" id="commandAgentCreateBtn">Create Task</button>
          </div>
        </div>
      </div>

      <!-- Notes Page -->
      <section id="notesPage" class="notes-page page container-fluid" hidden>
        <div class="notes-layout">
          <!--  LEFT SIDEBAR  -->
          <aside class="notes-left-sidebar">
            <div class="notes-left-search">
              <div class="notes-search-wrap">
                <i class="fal fa-search notes-search-icon"></i>
                <input type="text" id="notesSearchInput" class="notes-search-input" placeholder="Search notes...">
                <kbd class="notes-search-kbd">K</kbd>
              </div>
            </div>

            <nav class="notes-left-nav">
              <div class="notes-nav-row">
                <a class="notes-nav-item active" data-filter="mine">
                  <i class="fal fa-sticky-note"></i> My notes
                </a>
                <button class="notes-nav-action" id="notesNewTextNoteBtn" title="New text note" type="button">
                  <i class="fal fa-plus" aria-hidden="true"></i>
                </button>
              </div>
            </nav>

            <div class="notes-left-divider"></div>

            <div class="notes-left-section">
              <div class="notes-section-header">
                <span class="notes-section-label">Folders</span>
                <button class="notes-add-folder-btn" id="notesAddFolderBtn" title="New folder">
                  <i class="fal fa-plus"></i>
                </button>
              </div>
              <div id="notesFolderList" class="notes-folder-list"></div>
            </div>

            <div class="notes-left-divider"></div>

            <div class="notes-left-section">
              <div class="notes-section-header">
                <span class="notes-section-label">Teammates</span>
              </div>
              <div class="notes-teammates-placeholder">
                <span class="notes-placeholder-text">Coming soon</span>
              </div>
            </div>

            <div class="notes-left-footer">
              <div class="notes-left-footer-actions">
                <button class="notes-settings-btn notes-templates-btn" id="notesTemplatesBtn" title="Templates">
                  <i class="fal fa-layer-group"></i>
                </button>
                <button class="notes-settings-btn" id="notesSettingsBtn" title="Settings">
                  <i class="fal fa-cog"></i>
                </button>
              </div>
            </div>
          </aside>

          <!--  CENTER PANEL  -->
          <main class="notes-center-panel">
            <!-- Recording Toolbar (always visible) -->
            <div class="notes-recording-toolbar">
              <div class="notes-toolbar-left">
                <input type="text" class="notes-toolbar-title" id="notesTitleInput" placeholder="Meeting title...">
                <div class="notes-toolbar-capture">
                  <label class="notes-toolbar-checkbox">
                    <input type="checkbox" id="notesCaptureMic" checked aria-label="Capture microphone"> <i class="fal fa-microphone"></i>
                  </label>
                  <label class="notes-toolbar-checkbox">
                    <input type="checkbox" id="notesCaptureSystem" aria-label="Capture system audio"> <i class="fal fa-desktop"></i>
                  </label>
                </div>
              </div>
              <div class="notes-toolbar-center">
                <button class="notes-record-btn" id="notesStartBtn" title="Start Recording" type="button">
                  <span class="notes-record-btn-dot" aria-hidden="true"></span>
                </button>
                <button class="notes-control-btn hidden" id="notesPauseBtn" title="Pause">
                  <i class="fal fa-pause"></i>
                </button>
                <button class="notes-control-btn hidden" id="notesResumeBtn" title="Resume">
                  <i class="fal fa-play"></i>
                </button>
                <button class="notes-control-btn notes-stop-btn hidden" id="notesStopBtn" title="Stop">
                  <i class="fal fa-stop"></i>
                </button>
              </div>
              <div class="notes-toolbar-right">
                <div id="notesRecordingIndicator" class="notes-recording-indicator hidden">
                  <span class="notes-recording-dot"></span>
                  <span>REC</span>
                </div>
                <span id="notesTimer" class="notes-timer">00:00:00</span>
                <button class="notes-model-badge" id="notesModelStatus" title="Click for model settings">
                  Checking...
                </button>
              </div>
            </div>

            <!-- Default View: session list -->
            <div id="notesCenterDefault" class="notes-center-default">
              <div class="notes-coming-up" id="notesComingUp">
                <h6 class="notes-date-heading">Coming up</h6>
                <div id="notesUpcomingEvents" class="notes-upcoming-list">
                  <div class="notes-empty-upcoming">No upcoming meetings</div>
                </div>
              </div>
              <div id="notesPastMeetings" class="notes-past-meetings"></div>
            </div>

            <!-- Transcript View (hidden by default) -->
            <div id="notesCenterTranscript" class="notes-center-transcript" style="display:none;">
              <div class="notes-transcript-toolbar">
                <button class="notes-back-btn" id="notesBackBtn">
                  <i class="fal fa-arrow-left"></i> Back
                </button>
                <div class="notes-transcript-actions">
                  <button class="notes-btn notes-btn-sm" id="notesCopyBtn" title="Copy to clipboard">
                    <i class="fal fa-copy"></i> Copy
                  </button>
                  <button class="notes-btn notes-btn-sm" id="notesExportTxt" title="Export as text">TXT</button>
                  <button class="notes-btn notes-btn-sm" id="notesExportMd" title="Export as markdown">MD</button>
                  <button class="notes-btn notes-btn-sm" id="notesExportJson" title="Export as JSON">JSON</button>
                  <div id="notesTranscriptFolderDropdown" class="custom-dropdown-wrapper notes-transcript-folder-dropdown"></div>
                  <button class="notes-btn notes-btn-sm notes-btn-danger" id="notesDeleteBtn" title="Delete this note">
                    <i class="fal fa-trash-alt"></i> Delete
                  </button>
                </div>
              </div>
              <div class="notes-transcript-header">
                <input
                  id="notesTranscriptTitleInput"
                  class="notes-transcript-title-input"
                  type="text"
                  placeholder="Untitled"
                  autocomplete="off"
                >
                <button class="notes-btn notes-btn-sm notes-sparkle-btn" id="notesTranscriptSummarizeBtn" title="Summarize with AI">
                  <svg class="notes-sparkle-svg" viewBox="0 0 24 24" aria-hidden="true">
                    <path fill="currentColor" d="M12 2l1.15 4.3L17.5 7.5l-4.35 1.2L12 13l-1.15-4.3L6.5 7.5l4.35-1.2L12 2zm7.1 6.9l.7 2.6L22 12l-2.2.5-.7 2.6-.7-2.6L16 12l2.2-.5.7-2.6zM4.9 13.9l.9 3.4L9 18l-3.2.7-.9 3.4-.9-3.4L1 18l3-.7.9-3.4z"/>
                  </svg>
                </button>
              </div>
              <div class="notes-transcript-meta" id="notesTranscriptMeta"></div>
              <div class="notes-transcript-scroll-area">
                <div class="notes-transcript-summary" id="notesTranscriptSummary" style="display:none;">
                  <div class="notes-summary-top">
                    <div class="notes-summary-title">
                      <svg class="notes-sparkle-svg" viewBox="0 0 24 24" aria-hidden="true">
                        <path fill="currentColor" d="M12 2l1.15 4.3L17.5 7.5l-4.35 1.2L12 13l-1.15-4.3L6.5 7.5l4.35-1.2L12 2zm7.1 6.9l.7 2.6L22 12l-2.2.5-.7 2.6-.7-2.6L16 12l2.2-.5.7-2.6zM4.9 13.9l.9 3.4L9 18l-3.2.7-.9 3.4-.9-3.4L1 18l3-.7.9-3.4z"/>
                      </svg>
                      Summary
                    </div>
                    <div class="notes-summary-status" id="notesSummaryStatus">Ready</div>
                  </div>
                  <div class="notes-summary-body" id="notesSummaryContent"></div>
                </div>
                <textarea
                  id="notesTextNoteEditor"
                  class="notes-textnote-editor"
                  placeholder="Write notes here..."
                  style="display:none;"
                  spellcheck="true"
                ></textarea>
                <div id="notesTranscript" class="notes-transcript-body">
                  <div class="notes-transcript-empty">
                    <i class="fal fa-microphone-alt"></i>
                    <p>Start recording to see the live transcript</p>
                  </div>
                </div>
              </div>
            </div>
          </main>

          <!--  RIGHT CHAT SIDEBAR  -->
          <aside class="notes-right-sidebar">
            <div class="notes-chat-header">
              <div class="notes-chat-header-row">
                <div id="notesChatThreadDropdown" class="custom-dropdown-wrapper notes-chat-thread-dropdown"></div>
                <button class="notes-new-chat-btn" id="notesNewChatBtn" title="New chat">
                  <i class="fal fa-plus"></i>
                </button>
              </div>
              <div class="notes-chat-header-row secondary">
                <div id="notesChatAgentDropdown" class="custom-dropdown-wrapper notes-chat-agent-dropdown"></div>
              </div>
            </div>

            <div id="notesSkillSuggestions" class="notes-skill-suggestions">
              <div class="notes-templates-header">
                <div class="notes-templates-title">Templates</div>
                <div class="notes-templates-hint">Click to run</div>
              </div>
              <div id="notesTemplateChips" class="notes-template-chips"></div>
            </div>

            <div id="notesChatMessages" class="notes-chat-messages">
              <div class="notes-chat-empty">
                <i class="fal fa-comment-alt-dots"></i>
                <p>Ask anything about your meeting...</p>
              </div>
            </div>

            <div class="notes-chat-input-wrap">
              <textarea id="notesChatInput" class="notes-chat-input" placeholder="Ask anything..." rows="1"></textarea>
              <button class="notes-chat-send" id="notesChatSendBtn">
                <i class="fal fa-paper-plane"></i>
              </button>
            </div>
          </aside>
        </div>

        <!-- Notes Templates Modal -->
        <div class="notes-model-modal-overlay" id="notesTemplatesModal" style="display:none;" role="dialog" aria-modal="true" aria-label="Templates">
          <div class="notes-model-modal notes-templates-modal">
            <div class="notes-modal-header">
              <div class="notes-modal-header-left">
                <h6 class="notes-modal-title">Templates</h6>
                <div class="notes-templates-subtitle">Prompts used to guide the Notes agent</div>
              </div>
              <button class="notes-modal-close" id="notesTemplatesCloseBtn">
                <i class="fal fa-times"></i>
              </button>
            </div>
            <div class="notes-modal-body notes-templates-body">
              <div class="notes-templates-left">
                <div class="notes-templates-left-top">
                  <div class="notes-templates-left-title">Your templates</div>
                  <button class="notes-btn notes-btn-sm" id="notesTemplatesNewBtn" type="button">
                    <i class="fal fa-plus"></i> New
                  </button>
                </div>
                <div id="notesTemplatesList" class="notes-templates-list"></div>
              </div>
              <div class="notes-templates-editor">
                <div class="notes-templates-field">
                  <label class="notes-templates-label" for="notesTemplateName">Name</label>
                  <input id="notesTemplateName" class="notes-templates-input" type="text" placeholder="e.g. Create Linear Ticket">
                </div>
                <div class="notes-templates-field notes-templates-field-row">
                  <div class="notes-templates-field">
                    <label class="notes-templates-label" for="notesTemplateCommand">Slash command (optional)</label>
                    <input id="notesTemplateCommand" class="notes-templates-input" type="text" placeholder="/create-linear-ticket">
                  </div>
                  <label class="notes-templates-pin">
                    <input id="notesTemplatePinned" type="checkbox">
                    <span>Pin in sidebar</span>
                  </label>
                </div>
                <div class="notes-templates-field notes-templates-field-grow">
                  <label class="notes-templates-label" for="notesTemplatePrompt">Prompt</label>
                  <textarea id="notesTemplatePrompt" class="notes-templates-textarea" placeholder="Write the instructions given to the agent..."></textarea>
                  <div class="notes-templates-help">
                    Tip: include <code>{{transcript}}</code> to control where the transcript is inserted. If omitted, the transcript is appended automatically.
                  </div>
                </div>
                <div class="notes-templates-actions">
                  <button class="notes-btn notes-btn-danger" id="notesTemplatesDeleteBtn" type="button" title="Delete this template">
                    <i class="fal fa-trash"></i> Delete
                  </button>
                  <div class="notes-templates-actions-right">
                    <button class="notes-btn" id="notesTemplatesResetBtn" type="button" title="Reset templates back to defaults">
                      <i class="fal fa-undo"></i> Reset
                    </button>
                    <button class="notes-btn" id="notesTemplatesSaveBtn" type="button">
                      <i class="fal fa-save"></i> Save
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Notes Settings Modal -->
        <div class="notes-model-modal-overlay" id="notesModelModal" style="display:none;" role="dialog" aria-modal="true" aria-label="Notes Settings">
          <div class="notes-model-modal notes-settings-modal">
            <div class="notes-modal-header">
              <div class="notes-modal-header-left">
                <h6 class="notes-modal-title">Notes Settings</h6>
                <div class="notes-modal-tabs" role="tablist" aria-label="Notes settings tabs">
                  <button class="notes-modal-tab active" id="notesModalTabModels" type="button" data-tab="models" role="tab" aria-selected="true">Models</button>
                  <button class="notes-modal-tab" id="notesModalTabCalendar" type="button" data-tab="calendar" role="tab" aria-selected="false">Calendar</button>
                  <button class="notes-modal-tab" id="notesModalTabDictation" type="button" data-tab="dictation" role="tab" aria-selected="false">Dictation</button>
                </div>
              </div>
              <button class="notes-modal-close" id="notesModalCloseBtn">
                <i class="fal fa-times"></i>
              </button>
            </div>
            <div class="notes-modal-body">
              <div class="notes-modal-panel" id="notesSettingsPanelModels" role="tabpanel" aria-labelledby="notesModalTabModels">
                <p class="notes-modal-status" id="notesModalModelStatus">Checking models...</p>

                <div class="notes-model-picker">
                  <div class="notes-model-picker-row">
                    <div class="notes-model-picker-label">Model</div>
                    <div id="notesModelDropdown" class="custom-dropdown-wrapper notes-model-dropdown"></div>
                  </div>
                  <div id="notesModelDetails" class="notes-model-details"></div>
                </div>

                <div id="notesModelProgress" class="notes-modal-progress" style="display:none;">
                  <div class="notes-modal-progress-bar">
                    <div id="notesModelProgressBar" class="notes-modal-progress-fill" style="width:0%"></div>
                  </div>
                  <span class="notes-modal-progress-text" id="notesModelProgressText">0%</span>
                </div>

                <div class="notes-modal-actions">
                  <button class="notes-btn" id="notesModelDownloadBtn">
                    <i class="fal fa-download"></i> Download Model
                  </button>
                  <button class="notes-btn" id="notesModelCancelBtn" style="display:none;" title="Cancel the current download">
                    <i class="fal fa-ban"></i> Cancel
                  </button>
                  <button class="notes-btn" id="notesModelSetActiveBtn" title="Use this model for transcription">
                    <i class="fal fa-check"></i> Set Active
                  </button>
                  <button class="notes-btn notes-btn-danger" id="notesModelDeleteBtn" title="Delete the selected model from disk">
                    <i class="fal fa-trash"></i> Delete
                  </button>
                </div>
              </div>

              <div class="notes-modal-panel" id="notesSettingsPanelCalendar" role="tabpanel" aria-labelledby="notesModalTabCalendar" hidden>
                <p class="notes-modal-status" id="notesCalendarStatus">Calendar is disabled.</p>

                <div class="notes-calendar-settings">
                  <div class="notes-calendar-toggle-row">
                    <div class="notes-calendar-toggle-text">
                      <div class="notes-calendar-toggle-title">Show upcoming meetings</div>
                      <div class="notes-calendar-toggle-sub">Pulls events from Apple Calendar on this Mac.</div>
                    </div>
                    <label class="notes-switch">
                      <input type="checkbox" id="notesCalendarEnabledToggle">
                      <span class="notes-switch-slider"></span>
                    </label>
                  </div>

                  <div class="notes-calendar-picker" id="notesCalendarPicker" style="display:none;">
                    <div class="notes-calendar-picker-header">
                      <div class="notes-calendar-picker-title">Calendars</div>
                      <div class="notes-calendar-picker-actions">
                        <button class="notes-btn notes-btn-sm" id="notesCalendarSelectAllBtn" type="button">All</button>
                        <button class="notes-btn notes-btn-sm" id="notesCalendarClearBtn" type="button">None</button>
                        <button class="notes-btn notes-btn-sm" id="notesCalendarRefreshBtn" type="button">
                          <i class="fal fa-sync"></i>
                        </button>
                      </div>
                    </div>
                    <div class="notes-calendar-list" id="notesCalendarList"></div>
                  </div>
                </div>
              </div>

              <div class="notes-modal-panel" id="notesSettingsPanelDictation" role="tabpanel" aria-labelledby="notesModalTabDictation" hidden>
                <p class="notes-modal-status" id="notesDictationStatus">Dictation status: checking...</p>

                <div class="notes-dictation-settings">
                  <div class="notes-dictation-toggle-row">
                    <div class="notes-dictation-toggle-text">
                      <div class="notes-dictation-toggle-title">Enable global dictation</div>
                      <div class="notes-dictation-toggle-sub">Use a keybind from any app to transcribe into the focused text box.</div>
                    </div>
                    <label class="notes-switch">
                      <input type="checkbox" id="notesDictationEnabledToggle">
                      <span class="notes-switch-slider"></span>
                    </label>
                  </div>

	                  <div class="notes-dictation-card notes-dictation-card-activation">
	                    <div class="notes-dictation-card-title">Activation</div>
	                    <div class="notes-dictation-row">
	                      <div class="notes-dictation-label">Mode</div>
	                      <select id="notesDictationActivationSelect" class="notes-model-select" aria-label="Dictation activation mode">
	                        <option value="fn_hold">Hold Fn (macOS)</option>
	                        <option value="fn_double_press">Fn double-press (macOS)</option>
	                        <option value="global_shortcut">Custom shortcut</option>
	                      </select>
	                    </div>

	                    <div class="notes-dictation-row" id="notesDictationShortcutRow" style="display:none;">
	                      <div class="notes-dictation-label">Shortcut</div>
	                      <input id="notesDictationShortcutInput" class="notes-dictation-input" type="text" placeholder="Alt+Space">
	                    </div>

                    <div class="notes-dictation-help">
                      Tip: Fn detection may require Input Monitoring permission. Pasting into other apps requires Accessibility (we'll only ask when you enable it).
                    </div>
                  </div>

                  <div class="notes-dictation-card notes-dictation-card-transcription">
                    <div class="notes-dictation-card-title">Transcription</div>
                    <div class="notes-dictation-row">
                      <div class="notes-dictation-label">Engine</div>
                      <select id="notesDictationEngineSelect" class="notes-model-select">
                        <option value="local">Local (On-device)</option>
                        <option value="chatgpt">Cloud (ChatGPT)</option>
                      </select>
                    </div>
                    <div class="notes-dictation-help" id="notesDictationEngineHelp">
                      Local runs fully on-device using the selected local model (Whisper or Parakeet). Cloud uses ChatGPT transcription (requires Codex login).
                    </div>
                  </div>

                  <div class="notes-dictation-card notes-dictation-card-insertion">
                    <div class="notes-dictation-card-title">Insertion</div>
                    <label class="notes-dictation-check">
                      <input type="checkbox" id="notesDictationPasteToggle">
                      <span>Paste into focused inputs (macOS will ask for Accessibility when enabled)</span>
                    </label>
                    <label class="notes-dictation-check">
                      <input type="checkbox" id="notesDictationClipboardFallbackToggle">
                      <span>Copy to clipboard when no input is focused</span>
                    </label>
                    <label class="notes-dictation-check">
                      <input type="checkbox" id="notesDictationRestoreClipboardToggle">
                      <span>Restore clipboard after paste (text only)</span>
                    </label>
                    <label class="notes-dictation-check">
                      <input type="checkbox" id="notesDictationFlattenToggle">
                      <span>Flatten newlines when pasting into single-line fields</span>
                    </label>
                  </div>

                  <div class="notes-dictation-card notes-dictation-card-cleanup">
                    <div class="notes-dictation-card-title">Cleanup</div>
                    <label class="notes-dictation-check">
                      <input type="checkbox" id="notesDictationCleanupToggle">
                      <span>Remove filler words (um, uh, erm, etc.)</span>
                    </label>
                    <label class="notes-dictation-check">
                      <input type="checkbox" id="notesDictationCleanupLikeToggle">
                      <span>Also remove filler "like" (may remove legitimate uses)</span>
                    </label>
                  </div>

                  <div class="notes-dictation-actions notes-dictation-actions-bar">
                    <button class="notes-btn notes-btn-sm" id="notesDictationRefreshBtn" type="button">
                      <i class="fal fa-sync"></i> Refresh
                    </button>
                    <button class="notes-btn notes-btn-sm" id="notesDictationStartBtn" type="button">
                      <i class="fal fa-microphone"></i> Start
                    </button>
                    <button class="notes-btn notes-btn-sm notes-btn-danger" id="notesDictationStopBtn" type="button">
                      <i class="fal fa-stop"></i> Stop
                    </button>
                  </div>

                  <div class="notes-dictation-card notes-dictation-last">
                    <div class="notes-dictation-card-title">Last Transcript</div>
                    <textarea id="notesDictationLastTranscript" class="notes-dictation-textarea" readonly placeholder="No transcript yet."></textarea>
                    <div class="notes-dictation-actions">
                      <button class="notes-btn notes-btn-sm" id="notesDictationCopyBtn" type="button">
                        <i class="fal fa-copy"></i> Copy
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Accessibility Permission Modal (shown only when user opts into paste) -->
        <div class="notes-model-modal-overlay" id="notesPermissionModal" style="display:none;" role="dialog" aria-modal="true" aria-label="Permission Required">
          <div class="notes-model-modal" style="max-width: 560px;">
            <div class="notes-modal-header">
              <div class="notes-modal-header-left">
                <h6 class="notes-modal-title" id="notesPermissionTitle">Permission Required</h6>
              </div>
              <button class="notes-modal-close" id="notesPermissionCloseBtn" aria-label="Close">
                <i class="fal fa-times"></i>
              </button>
            </div>
            <div class="notes-modal-body" style="padding: 14px 16px;">
              <p class="muted-text" id="notesPermissionBody" style="margin-bottom: 12px;">
                To paste transcripts directly into other apps, macOS will ask for Accessibility permission.
              </p>
              <div class="notes-modal-actions" style="padding: 0; gap: 10px; justify-content: flex-end;">
                <button class="notes-btn notes-btn-sm" id="notesPermissionCancelBtn" type="button">Not now</button>
                <button class="notes-btn notes-btn-sm notes-btn-brand" id="notesPermissionContinueBtn" type="button">
                  Continue
                </button>
              </div>
            </div>
          </div>
        </div>

      </section>

      <!-- Cmd+K Search Palette (global) -->
      <div class="notes-palette-overlay" id="notesSearchPalette" hidden>
        <div class="notes-palette" role="dialog" aria-modal="true" aria-label="Search">
          <div class="notes-palette-top">
            <i class="fal fa-search notes-palette-icon"></i>
            <input
              type="text"
              id="notesPaletteInput"
              class="notes-palette-input"
              placeholder="Search tasks and notes"
              autocomplete="off"
              spellcheck="false"
            >
            <kbd class="notes-palette-kbd">esc</kbd>
          </div>
          <div class="notes-palette-results" id="notesPaletteResults"></div>
          <div class="notes-palette-footer">
            <div class="notes-palette-hint">
              <kbd></kbd><kbd></kbd> Navigate <kbd></kbd> Open
            </div>
            <div class="notes-palette-controls">
              <div class="notes-palette-status" id="notesPaletteIndexStatus" aria-live="polite"></div>
              <label class="notes-palette-toggle" title="Exact (keyword-only, no semantic rerank)">
                <input type="checkbox" id="notesPaletteExactToggle">
                <span>Exact</span>
              </label>
            </div>
          </div>
        </div>
      </div>

      <!--Settings Page-->
      <section
        id="settingsPage"
        class="settings-page page container-fluid"
        hidden
      >
        <div class="row no-gutters">
          <!-- Settings Cards Container -->
          <div class="col-12">
            <div class="settings-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; padding: 16px;">

              <!-- Notifications Card -->
              <div class="card settings-card">
                <div class="card-body">
                  <h5 class="settings-card-title mb-3">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px; opacity: 0.7;">
                      <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                      <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                    </svg>
                    Notifications
                  </h5>
                  <div class="form-group mb-3">
                    <label class="settings-label">Discord Bot Token</label>
                    <div class="input-group">
                      <input
                        type="password"
                        class="form-control"
                        id="discordBotToken"
                        placeholder="Bot token"
                      />
                      <div class="input-group-append">
                        <a id="testDiscord" class="btn btn-outline-secondary btn-sm">Test</a>
                      </div>
                    </div>
                  </div>
                  <div class="form-group mb-3">
                    <label class="settings-label">Discord Channel ID</label>
                    <div class="input-group">
                      <input
                        type="text"
                        class="form-control"
                        id="discordChannelId"
                        placeholder="Channel ID for notifications"
                      />
                    </div>
                  </div>
                  <div class="settings-toggles">
                    <div class="settings-toggle-row">
                      <span class="settings-toggle-label">Enable Discord bot</span>
                      <div class="toggle-buttons" data-toggle="discord-enabled">
                        <button class="toggle-button" type="button" data-value="false">Off</button>
                        <button class="toggle-button" type="button" data-value="true">On</button>
                        <input type="checkbox" id="discordEnabled" />
                      </div>
                    </div>
                    <div class="settings-toggle-row">
                      <span class="settings-toggle-label">Enable agent notifications</span>
                      <div class="toggle-buttons" data-toggle="agent-notifications">
                        <button class="toggle-button" type="button" data-value="false">Off</button>
                        <button class="toggle-button" type="button" data-value="true">On</button>
                        <input type="checkbox" id="agentNotificationsEnabled" />
                      </div>
                    </div>
                    <div class="settings-toggle-row">
                      <span class="settings-toggle-label">Stack notifications</span>
                      <div class="toggle-buttons" data-toggle="notification-stack">
                        <button class="toggle-button" type="button" data-value="false">Off</button>
                        <button class="toggle-button" type="button" data-value="true">On</button>
                        <input type="checkbox" id="agentNotificationStack" />
                      </div>
                    </div>
                    <div class="settings-toggle-row">
                      <span class="settings-toggle-label">Auto-dismiss after</span>
                      <div id="agentNotificationTimeoutDropdown" class="settings-dropdown"></div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- AI Summaries & Agents Card -->
              <div class="card settings-card">
                <div class="card-body">
                  <!-- AI Summaries Section -->
                  <div class="d-flex align-items-center justify-content-between mb-3">
                    <h5 class="settings-card-title mb-0">
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px; opacity: 0.7;">
                        <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"></path>
                        <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                        <line x1="12" y1="19" x2="12" y2="22"></line>
                      </svg>
                      AI Summaries
                    </h5>
                    <div class="toggle-buttons" data-toggle="ai-summaries">
                      <button class="toggle-button" type="button" data-value="false">Off</button>
                      <button class="toggle-button" type="button" data-value="true">On</button>
                      <input type="checkbox" id="aiSummariesEnabled" />
                    </div>
                  </div>
                  <small class="text-muted d-block mb-3">
                    Generate smart task titles, status summaries, and branch names using AI.
                  </small>

                  <!-- Summaries Agent Dropdown -->
                  <div class="form-group mb-3" id="summariesAgentGroup">
                    <label class="settings-label">Summaries Agent</label>
                    <div id="summariesAgentDropdown" class="custom-dropdown-wrapper"></div>
                    <small class="text-muted d-block mt-1">
                      Select which agent generates summaries.
                    </small>
                  </div>

                  <!-- Divider -->
                  <hr style="border-color: rgba(255,255,255,0.1); margin: 1rem 0;">

                  <!-- Agents Section -->
                  <div class="d-flex align-items-center justify-content-between mb-3">
                    <h5 class="settings-card-title mb-0">
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px; opacity: 0.7;">
                        <path d="M3 7h18M3 12h18M3 17h18"></path>
                        <circle cx="7" cy="7" r="2"></circle>
                        <circle cx="7" cy="12" r="2"></circle>
                        <circle cx="7" cy="17" r="2"></circle>
                      </svg>
                      Agents
                    </h5>
                    <button class="btn btn-outline-secondary btn-sm" id="refreshAgentsBtn">
                      Refresh agents
                    </button>
                  </div>
                  <small class="text-muted d-block mb-0">
                    Re-check installed agent CLIs and update availability.
                  </small>
                </div>
              </div>

              <!-- Codex Card -->
              <div class="card settings-card">
                <div class="card-body">
                  <h5 class="settings-card-title mb-3">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px; opacity: 0.7;">
                      <path d="M12 2l7 4v6c0 5-3 9-7 10-4-1-7-5-7-10V6l7-4Z"></path>
                      <path d="M9 12h6"></path>
                      <path d="M10 16h4"></path>
                    </svg>
                    Codex
                  </h5>

                  <div class="form-group mb-3">
                    <label class="settings-label">Codex Path</label>
                    <input
                      type="text"
                      class="form-control"
                      id="codexPath"
                      placeholder="/opt/homebrew/bin/codex"
                    />
                    <small class="text-muted d-block mt-2">
                      Optional override for the <code>codex</code> executable.
                    </small>
                  </div>

                  <div class="form-group mb-3">
                    <label class="settings-label">Default Access Mode</label>
                    <div id="codexAccessModeDropdown" class="custom-dropdown-wrapper"></div>
                    <small class="text-muted d-block mt-2">
                      Used for Codex tasks created in Phantom.
                    </small>
                  </div>

                  <div class="form-group mb-3">
                    <label class="settings-label">Personality</label>
                    <input
                      type="text"
                      class="form-control"
                      id="codexPersonality"
                      placeholder="default"
                    />
                    <small class="text-muted d-block mt-2">
                      Read from the active Codex account's <code>CODEX_HOME/config.toml</code>.
                    </small>
                  </div>

                  <div class="settings-toggles">
                    <div class="settings-toggle-row">
                      <span class="settings-toggle-label">Collaboration Modes</span>
                      <div class="toggle-buttons" data-toggle="codex-collaboration-modes">
                        <button class="toggle-button" type="button" data-value="false">Off</button>
                        <button class="toggle-button" type="button" data-value="true">On</button>
                        <input type="checkbox" id="codexFeatureCollaborationModes" />
                      </div>
                    </div>
                    <div class="settings-toggle-row">
                      <span class="settings-toggle-label">Steer</span>
                      <div class="toggle-buttons" data-toggle="codex-steer">
                        <button class="toggle-button" type="button" data-value="false">Off</button>
                        <button class="toggle-button" type="button" data-value="true">On</button>
                        <input type="checkbox" id="codexFeatureSteer" />
                      </div>
                    </div>
                    <div class="settings-toggle-row">
                      <span class="settings-toggle-label">Unified Exec</span>
                      <div class="toggle-buttons" data-toggle="codex-unified-exec">
                        <button class="toggle-button" type="button" data-value="false">Off</button>
                        <button class="toggle-button" type="button" data-value="true">On</button>
                        <input type="checkbox" id="codexFeatureUnifiedExec" />
                      </div>
                    </div>
                    <div class="settings-toggle-row">
                      <span class="settings-toggle-label">Collab (Experimental)</span>
                      <div class="toggle-buttons" data-toggle="codex-collab">
                        <button class="toggle-button" type="button" data-value="false">Off</button>
                        <button class="toggle-button" type="button" data-value="true">On</button>
                        <input type="checkbox" id="codexFeatureCollab" />
                      </div>
                    </div>
                    <div class="settings-toggle-row">
                      <span class="settings-toggle-label">Apps (Experimental)</span>
                      <div class="toggle-buttons" data-toggle="codex-apps">
                        <button class="toggle-button" type="button" data-value="false">Off</button>
                        <button class="toggle-button" type="button" data-value="true">On</button>
                        <input type="checkbox" id="codexFeatureApps" />
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Task Projects Card -->
              <div class="card settings-card">
                <div class="card-body">
                  <h5 class="settings-card-title mb-3">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px; opacity: 0.7;">
                      <path d="M3 7h18"></path>
                      <path d="M5 7l1 12h12l1-12"></path>
                      <path d="M9 7V5a3 3 0 0 1 6 0v2"></path>
                    </svg>
                    Task Projects
                  </h5>
                  <div class="form-group mb-2">
                    <label class="settings-label">Project Allowlist</label>
                    <div class="list-group" id="taskProjectAllowlistList"></div>
                    <small class="text-muted d-block mt-2">
                      Star recent projects to pin them. Click a starred project to configure its workspace scripts.
                    </small>
                  </div>
                </div>
              </div>

              <!-- MCP Server Card -->
              <div class="card settings-card">
                <div class="card-body">
                  <div class="d-flex align-items-center justify-content-between mb-3">
                    <h5 class="settings-card-title mb-0">
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px; opacity: 0.7;">
                        <path d="M4 7h16M4 12h16M4 17h16"></path>
                        <circle cx="8" cy="7" r="2"></circle>
                        <circle cx="8" cy="12" r="2"></circle>
                        <circle cx="8" cy="17" r="2"></circle>
                      </svg>
                      MCP Server
                    </h5>
                    <div class="toggle-buttons" data-toggle="mcp-enabled">
                      <button class="toggle-button" type="button" data-value="false">Off</button>
                      <button class="toggle-button" type="button" data-value="true">On</button>
                      <input type="checkbox" id="mcpEnabled" />
                    </div>
                  </div>
                  <div class="form-group mb-3">
                    <label class="settings-label">Local MCP Port</label>
                    <input
                      type="number"
                      class="form-control"
                      id="mcpPort"
                      min="1"
                      max="65535"
                      placeholder="43778"
                    />
                    <small class="text-muted d-block mt-2">
                      Phantom must be open for local MCP access. Changes apply on next launch.
                    </small>
                  </div>
                  <div class="form-group mb-2">
                    <label class="settings-label">MCP Token</label>
                    <div class="input-group">
                      <input
                        type="password"
                        class="form-control"
                        id="mcpToken"
                        placeholder="Token"
                      />
                      <div class="input-group-append">
                        <button class="btn btn-outline-secondary btn-sm" id="mcpTokenReveal">Show</button>
                        <button class="btn btn-outline-secondary btn-sm" id="mcpTokenCopy">Copy</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Keyboard Shortcuts Card (Full Width) -->
              <div class="card settings-card" style="grid-column: span 2;">
                <div class="card-body">
                  <div class="d-flex align-items-center justify-content-between mb-3">
                    <h5 class="settings-card-title mb-0">
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px; opacity: 0.7;">
                        <rect x="2" y="4" width="20" height="16" rx="2" ry="2"></rect>
                        <path d="M6 8h.01M10 8h.01M14 8h.01M18 8h.01M8 12h.01M12 12h.01M16 12h.01M7 16h10"></path>
                      </svg>
                      Keyboard Shortcuts
                    </h5>
                    <button class="btn btn-outline-secondary btn-sm" id="resetKeybindsBtn">
                      Reset to Defaults
                    </button>
                  </div>
                  <div class="keybinds-grid" id="keybindsGrid">
                    <!-- Navigation -->
                    <div class="keybinds-section">
                      <div class="keybinds-section-title">Navigation</div>
                      <div class="keybind-row" data-action="nav.createTasks">
                        <span class="keybind-label">Create Tasks</span>
                        <button class="keybind-input" data-keybind="nav.createTasks">
                          <span class="keybind-keys"></span>
                        </button>
                      </div>
                      <div class="keybind-row" data-action="nav.viewTasks">
                        <span class="keybind-label">View Tasks</span>
                        <button class="keybind-input" data-keybind="nav.viewTasks">
                          <span class="keybind-keys"></span>
                        </button>
                      </div>
                      <div class="keybind-row" data-action="nav.accounts">
                        <span class="keybind-label">Accounts</span>
                        <button class="keybind-input" data-keybind="nav.accounts">
                          <span class="keybind-keys"></span>
                        </button>
                      </div>
                      <div class="keybind-row" data-action="nav.skills">
                        <span class="keybind-label">Skills</span>
                        <button class="keybind-input" data-keybind="nav.skills">
                          <span class="keybind-keys"></span>
                        </button>
                      </div>
                      <div class="keybind-row" data-action="nav.analytics">
                        <span class="keybind-label">Analytics</span>
                        <button class="keybind-input" data-keybind="nav.analytics">
                          <span class="keybind-keys"></span>
                        </button>
                      </div>
                      <div class="keybind-row" data-action="nav.review">
                        <span class="keybind-label">Review</span>
                        <button class="keybind-input" data-keybind="nav.review">
                          <span class="keybind-keys"></span>
                        </button>
                      </div>
                      <div class="keybind-row" data-action="nav.command">
                        <span class="keybind-label">Command</span>
                        <button class="keybind-input" data-keybind="nav.command">
                          <span class="keybind-keys"></span>
                        </button>
                      </div>
                      <div class="keybind-row" data-action="nav.settings">
                        <span class="keybind-label">Settings</span>
                        <button class="keybind-input" data-keybind="nav.settings">
                          <span class="keybind-keys"></span>
                        </button>
                      </div>
                    </div>
                    <!-- Agent Selection -->
                    <div class="keybinds-section">
                      <div class="keybinds-section-title">Agent Selection</div>
                      <div class="keybind-row" data-action="agent.codex">
                        <span class="keybind-label">Select Codex</span>
                        <button class="keybind-input" data-keybind="agent.codex">
                          <span class="keybind-keys"></span>
                        </button>
                      </div>
                      <div class="keybind-row" data-action="agent.claude">
                        <span class="keybind-label">Select Claude Code</span>
                        <button class="keybind-input" data-keybind="agent.claude">
                          <span class="keybind-keys"></span>
                        </button>
                      </div>
                      <div class="keybind-row" data-action="agent.amp">
                        <span class="keybind-label">Select Amp</span>
                        <button class="keybind-input" data-keybind="agent.amp">
                          <span class="keybind-keys"></span>
                        </button>
                      </div>
                      <div class="keybind-row" data-action="agent.droid">
                        <span class="keybind-label">Select Droid</span>
                        <button class="keybind-input" data-keybind="agent.droid">
                          <span class="keybind-keys"></span>
                        </button>
                      </div>
                      <div class="keybind-row" data-action="agent.opencode">
                        <span class="keybind-label">Select OpenCode</span>
                        <button class="keybind-input" data-keybind="agent.opencode">
                          <span class="keybind-keys"></span>
                        </button>
                      </div>
                      <div class="keybind-row" data-action="agent.factoryDroid">
                        <span class="keybind-label">Select Factory Droid</span>
                        <button class="keybind-input" data-keybind="agent.factoryDroid">
                          <span class="keybind-keys"></span>
                        </button>
                      </div>
                    </div>
                    <!-- Actions -->
                    <div class="keybinds-section">
                      <div class="keybinds-section-title">Actions</div>
                      <div class="keybind-row" data-action="action.createTask">
                        <span class="keybind-label">Create Task</span>
                        <button class="keybind-input" data-keybind="action.createTask">
                          <span class="keybind-keys"></span>
                        </button>
                      </div>
                      <div class="keybind-row" data-action="action.focusPrompt">
                        <span class="keybind-label">Focus Prompt</span>
                        <button class="keybind-input" data-keybind="action.focusPrompt">
                          <span class="keybind-keys"></span>
                        </button>
                      </div>
                      <div class="keybind-row" data-action="action.pickProject">
                        <span class="keybind-label">Pick Project Folder</span>
                        <button class="keybind-input" data-keybind="action.pickProject">
                          <span class="keybind-keys"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="keybind-conflict-warning" id="keybindConflictWarning" style="display: none;">
                    <i class="fal fa-exclamation-triangle"></i>
                    <span id="keybindConflictText">This shortcut is already in use</span>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>
      </section>

      <!-- Project Scripts Modal -->
      <div
        class="modal fade mt-5"
        id="projectScriptsModal"
        tabindex="-1"
        role="dialog"
        aria-labelledby="projectScriptsModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog mt-5" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="projectScriptsModalLabel">
                Project Scripts
              </h5>
              <button
                type="button"
                class="close"
                data-dismiss="modal"
                aria-label="Close"
              >
                <span aria-hidden="true"><i class="fal fa-times"></i></span>
              </button>
            </div>
            <div class="modal-body">
              <p class="text-muted mb-3" id="projectScriptsModalPath" style="font-size: 12px; word-break: break-all;"></p>
              <div class="form-group mb-3">
                <label class="settings-label" for="projectScriptsSetupInput">Setup Script</label>
                <input
                  type="text"
                  class="form-control"
                  id="projectScriptsSetupInput"
                  placeholder="./setup.sh"
                />
                <small class="text-muted d-block mt-1">
                  Runs from the task worktree. Use <code>{workspace}</code> for the absolute path.<br>
                  Example: <code>./setup.sh</code> or <code>pnpm install</code>.
                </small>
              </div>
              <div class="form-group mb-2">
                <label class="settings-label" for="projectScriptsRunInput">Run Script</label>
                <input
                  type="text"
                  class="form-control"
                  id="projectScriptsRunInput"
                  placeholder="./run.sh"
                />
                <small class="text-muted d-block mt-1">
                  Used by the chat view play button for one-click runs.<br>
                  Example: <code>./run.sh</code> or <code>pnpm dev</code>.
                </small>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-sm btn-secondary"
                data-dismiss="modal"
              >
                Close
              </button>
              <button
                type="button"
                class="btn btn-sm btn-brand"
                id="projectScriptsSaveBtn"
              >
                Save
              </button>
            </div>
          </div>
        </div>
      </div>

      <div
        class="modal fade mt-5"
        id="createInstanceModal"
        tabindex="-1"
        role="dialog"
        aria-labelledby="exampleModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog mt-5" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">
                Single use invite
              </h5>
              <button
                type="button"
                class="close"
                data-dismiss="modal"
                aria-label="Close"
              >
                <span aria-hidden="true"><i class="fal fa-times"></i></span>
              </button>
            </div>
            <div class="modal-body">
              <div class="form-inline justify-content-center">
                <div class="form-group">
                  <input
                    type="text"
                    readonly
                    class="form-control form-control-lg"
                    id="singleUseInstanceCode"
                    value="Unavailable"
                  />
                </div>
                <button
                  class="btn btn-brand btn-default btn-lg ml-2"
                  id="copyInstanceCode"
                  data-toggle="tooltip"
                  data-placement="top"
                  title="Copy to clipboard"
                >
                  <i class="fal fa-lg fa-copy"></i>
                </button>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-sm btn-secondary"
                data-dismiss="modal"
              >
                Close
              </button>
            </div>
          </div>
        </div>
      </div>

      <div
        class="modal fade mt-5"
        id="claudeOauthModal"
        tabindex="-1"
        role="dialog"
        aria-labelledby="claudeOauthModalLabel"
        aria-hidden="true"
        data-backdrop="static"
        data-keyboard="false"
      >
        <div class="modal-dialog mt-5" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="claudeOauthModalLabel">
                Sign in to Claude
              </h5>
              <button
                type="button"
                class="close"
                data-claude-oauth-cancel
                aria-label="Close"
              >
                <span aria-hidden="true"><i class="fal fa-times"></i></span>
              </button>
            </div>
            <div class="modal-body">
              <p class="muted-text">
                Complete the sign-in in your browser. If it didn't open, copy the
                URL below.
              </p>
              <div class="form-group">
                <label class="muted-label">OAuth URL</label>
                <div class="input-group">
                  <input
                    type="text"
                    readonly
                    class="form-control"
                    id="claudeOauthUrl"
                    value=""
                  />
                  <div class="input-group-append">
                    <button
                      class="btn btn-default btn-sm"
                      id="claudeOauthCopy"
                      title="Copy to clipboard"
                    >
                      <i class="fal fa-copy"></i>
                    </button>
                  </div>
                </div>
              </div>
              <div class="text-center mt-3">
                <i class="fal fa-spinner fa-spin"></i>
                <span class="muted-text ml-2">Waiting for sign-in...</span>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-sm btn-secondary"
                data-claude-oauth-cancel
              >
                Cancel
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Skills Apply Changes Confirmation Modal -->
    <div
      class="modal fade mt-5"
      id="applySkillChangesModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="applySkillChangesModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog mt-5" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="applySkillChangesModalLabel">
              <i class="fal fa-exclamation-triangle text-warning"></i> Agents Running
            </h5>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true"><i class="fal fa-times"></i></span>
            </button>
          </div>
          <div class="modal-body">
            <p>The following agents are currently running tasks:</p>
            <ul id="runningAgentsList" class="list-unstyled mb-3">
              <!-- Dynamically populated -->
            </ul>
            <p class="text-warning mb-0">
              <strong>Restarting will interrupt these tasks.</strong> Are you sure you want to apply skill changes now?
            </p>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-sm btn-secondary"
              data-dismiss="modal"
            >
              Cancel
            </button>
            <button
              type="button"
              class="btn btn-sm btn-danger"
              id="confirmApplySkillChanges"
            >
              <i class="fal fa-bolt"></i> Restart Anyway
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Delete Task Uncommitted Changes Warning Modal -->
    <div class="modal fade mt-5" id="deleteTaskWarningModal" tabindex="-1" role="dialog">
      <div class="modal-dialog mt-5" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">
              <i class="fal fa-exclamation-triangle text-warning"></i> Uncommitted Changes
            </h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true"><i class="fal fa-times"></i></span>
            </button>
          </div>
          <div class="modal-body">
            <p>This task's worktree has <strong>uncommitted changes</strong> that will be permanently lost:</p>
            <p class="text-muted small" id="deleteTaskWorktreePath"></p>
            <p class="text-warning mb-0">
              <strong>Are you sure you want to delete this task?</strong>
            </p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-sm btn-secondary" data-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-sm btn-danger" id="confirmDeleteTask">
              <i class="fal fa-trash-alt"></i> Delete Anyway
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Task Scheduler Modal -->
    <div
      class="modal fade mt-5"
      id="taskSchedulerModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="taskSchedulerModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg mt-5" role="document">
        <div class="modal-content task-scheduler-modal">
          <div class="modal-header">
            <div class="task-scheduler-modal-titlewrap">
              <h5 class="modal-title" id="taskSchedulerModalLabel">Schedule task</h5>
              <div class="task-scheduler-modal-sub" id="taskSchedulerModalSub">
                Create and auto-start tasks on a schedule while Phantom is open.
              </div>
            </div>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true"><i class="fal fa-times"></i></span>
            </button>
          </div>

          <div class="modal-body">
            <div class="task-scheduler-modal-shell">
              <div class="task-scheduler-modal-left">
                <div class="task-scheduler-modal-left-top">
                  <div class="task-scheduler-modal-left-title">Saved schedules</div>
                  <button class="btn btn-outline-secondary btn-sm" id="taskSchedulerNewBtn" type="button">
                    <i class="fal fa-plus"></i> New
                  </button>
                </div>
                <div id="taskSchedulerList" class="task-scheduler-list"></div>
              </div>

              <div class="task-scheduler-modal-right">
                <div class="task-scheduler-modal-banner">
                  <div class="task-scheduler-modal-banner-title">Runs as a task</div>
                  <div class="task-scheduler-modal-banner-sub">
                    When a schedule is due, Phantom creates a task (View Tasks) and auto-starts it.
                    Nothing runs while Phantom is closed.
                  </div>
                </div>

                <div class="task-scheduler-prompt-block">
                  <div class="task-scheduler-prompt-header">
                    <div class="task-scheduler-prompt-title">Prompt</div>
                    <div class="task-scheduler-prompt-actions">
                      <button class="btn btn-outline-secondary btn-sm" id="taskSchedulerUseDraftPromptBtn" type="button">
                        Use draft
                      </button>
                      <button class="btn btn-outline-secondary btn-sm" id="taskSchedulerCopyPromptBtn" type="button">
                        <i class="fal fa-copy"></i>
                      </button>
                    </div>
                  </div>
                  <textarea
                    id="taskSchedulerPromptPreview"
                    class="task-scheduler-prompt-textarea"
                    placeholder="(Uses the current Create Tasks prompt when you save a new schedule.)"
                  ></textarea>
                  <div class="task-scheduler-prompt-note">
                    You can edit the prompt here. Click Use draft to pull in the current Create Tasks prompt.
                  </div>
                </div>

                <div class="form-group mb-2">
                  <label class="muted-label" for="taskSchedulerNameInput">Name</label>
                  <input
                    type="text"
                    class="form-control form-control-sm"
                    id="taskSchedulerNameInput"
                    placeholder="e.g. Morning triage"
                  />
                </div>

                <div class="form-row">
                  <div class="form-group col-7 mb-2">
                    <label class="muted-label" for="taskSchedulerModeSelect">Schedule</label>
                    <select id="taskSchedulerModeSelect" class="form-control form-control-sm">
                      <option value="daily">Every day</option>
                      <option value="weekdays">Weekdays</option>
                      <option value="weekly">Weekly</option>
                      <option value="every_minutes">Every N minutes</option>
                      <option value="every_hours">Every N hours</option>
                    </select>
                  </div>
                  <div class="form-group col-5 mb-2" id="taskSchedulerTimeGroup">
                    <label class="muted-label" for="taskSchedulerTimeInput">Time</label>
                    <input id="taskSchedulerTimeInput" class="form-control form-control-sm" type="time" value="09:00" />
                  </div>
                </div>

                <div class="form-row" id="taskSchedulerWeeklyRow" style="display:none;">
                  <div class="form-group col-7 mb-2">
                    <label class="muted-label" for="taskSchedulerWeeklyDaySelect">Day</label>
                    <select id="taskSchedulerWeeklyDaySelect" class="form-control form-control-sm">
                      <option value="1">Monday</option>
                      <option value="2">Tuesday</option>
                      <option value="3">Wednesday</option>
                      <option value="4">Thursday</option>
                      <option value="5">Friday</option>
                      <option value="6">Saturday</option>
                      <option value="0">Sunday</option>
                    </select>
                  </div>
                  <div class="form-group col-5 mb-2">
                    <label class="muted-label">&nbsp;</label>
                    <div class="task-scheduler-hint">Uses the time above</div>
                  </div>
                </div>

                <div class="form-row" id="taskSchedulerEveryNRow" style="display:none;">
                  <div class="form-group col-7 mb-2">
                    <label class="muted-label" for="taskSchedulerEveryNInput">Every</label>
                    <input
                      id="taskSchedulerEveryNInput"
                      class="form-control form-control-sm"
                      type="number"
                      min="1"
                      max="720"
                      value="15"
                    />
                  </div>
                  <div class="form-group col-5 mb-2">
                    <label class="muted-label">&nbsp;</label>
                    <div class="task-scheduler-unit" id="taskSchedulerEveryNUnit">minutes</div>
                  </div>
                </div>

                <div class="setting-row task-scheduler-enabled-row">
                  <div class="setting-label">Enabled</div>
                  <div class="toggle-buttons" data-toggle="scheduler-enabled">
                    <button class="toggle-button" type="button" data-value="false">Off</button>
                    <button class="toggle-button" type="button" data-value="true">On</button>
                    <input type="checkbox" id="taskSchedulerEnabledToggle" checked />
                  </div>
                </div>

                <div class="task-scheduler-preview" id="taskSchedulerNextRunPreview">Next run: --</div>

                <div class="task-scheduler-actions">
                  <button class="btn btn-default btn-brand btn-sm" id="taskSchedulerSaveBtn" type="button">
                    <i class="fal fa-save"></i> Save
                  </button>
                  <button class="btn btn-outline-secondary btn-sm" id="taskSchedulerRunNowBtn" type="button" disabled>
                    <i class="fal fa-play"></i> Run now
                  </button>
                  <button class="btn btn-outline-secondary btn-sm" id="taskSchedulerToggleBtn" type="button" disabled>
                    Disable
                  </button>
                  <button class="btn btn-danger btn-sm" id="taskSchedulerDeleteBtn" type="button" disabled>
                    Delete
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-sm btn-secondary" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Custom File Browser Modal -->
    <div class="modal fade" id="fileBrowserModal" tabindex="-1" role="dialog" aria-labelledby="fileBrowserModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg file-browser-dialog" role="document">
        <div class="modal-content file-browser-content">
          <div class="modal-header file-browser-header">
            <h5 class="modal-title" id="fileBrowserModalLabel">
              <i class="fal fa-folder-open"></i> Select Project Folder
            </h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true"><i class="fal fa-times"></i></span>
            </button>
          </div>
          <div class="modal-body file-browser-body p-0">
            <!-- Breadcrumb navigation -->
            <div class="file-browser-breadcrumb">
              <div class="breadcrumb-path" id="fileBrowserBreadcrumb"></div>
              <div class="breadcrumb-actions">
                <button type="button" class="btn btn-sm btn-icon" id="fileBrowserToggleHidden" title="Show hidden files">
                  <i class="fal fa-eye-slash"></i>
                </button>
              </div>
            </div>

            <!-- Main content area -->
            <div class="file-browser-main">
              <!-- Quick access sidebar -->
              <div class="file-browser-sidebar">
                <div class="sidebar-section">
                  <div class="sidebar-title">Quick Access</div>
                  <div id="fileBrowserQuickAccess" class="quick-access-list"></div>
                </div>
                <div class="sidebar-section">
                  <div class="sidebar-title">Recent Projects</div>
                  <div id="fileBrowserRecentProjects" class="quick-access-list"></div>
                </div>
              </div>

              <!-- File listing -->
              <div class="file-browser-listing">
                <div id="fileBrowserLoading" class="file-browser-loading">
                  <i class="fal fa-spinner fa-spin"></i> Loading...
                </div>
                <div id="fileBrowserEmpty" class="file-browser-empty" style="display: none;">
                  <i class="fal fa-folder-open"></i>
                  <p>This folder is empty</p>
                </div>
                <div id="fileBrowserEntries" class="file-entries"></div>
              </div>
            </div>

            <!-- Path input -->
            <div class="file-browser-path-input">
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text"><i class="fal fa-folder"></i></span>
                </div>
                <input type="text" class="form-control" id="fileBrowserPathInput" placeholder="Enter path..." />
                <div class="input-group-append">
                  <button class="btn btn-sm" type="button" id="fileBrowserGoToPath">Go</button>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer file-browser-footer">
            <div class="selected-path-display">
              <span class="selected-label">Selected:</span>
              <span id="fileBrowserSelectedPath" class="selected-path">None</span>
            </div>
            <div class="footer-actions">
              <button type="button" class="btn btn-sm btn-secondary" data-dismiss="modal">Cancel</button>
              <button type="button" class="btn btn-sm btn-brand" id="fileBrowserSelectBtn" disabled>
                <i class="fal fa-check"></i> Select Folder
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Command Center Configuration Modal -->
    <div class="modal fade" id="commandCenterConfigModal" tabindex="-1" role="dialog" aria-labelledby="commandCenterConfigModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="commandCenterConfigModalLabel">
              <i class="fal fa-cog"></i> Command Center Configuration
            </h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true"><i class="fal fa-times"></i></span>
            </button>
          </div>
          <div class="modal-body p-0">
            <!-- Tabs -->
            <ul class="nav nav-tabs cc-config-tabs" role="tablist">
              <li class="nav-item">
                <a class="nav-link active" id="ccTabGithub" data-toggle="tab" href="#ccPaneGithub" role="tab">
                  <i class="fab fa-github"></i> GitHub
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" id="ccTabLinear" data-toggle="tab" href="#ccPaneLinear" role="tab">
                  <span class="command-logo-linear" style="vertical-align: middle;"></span> Linear
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" id="ccTabSentry" data-toggle="tab" href="#ccPaneSentry" role="tab">
                  <span class="command-logo-sentry" style="vertical-align: middle;"></span> Sentry
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" id="ccTabGeneral" data-toggle="tab" href="#ccPaneGeneral" role="tab">
                  <i class="fal fa-sliders-h"></i> General
                </a>
              </li>
            </ul>

            <!-- Tab Content -->
            <div class="tab-content cc-config-content">
              <!-- GitHub Tab -->
              <div class="tab-pane fade show active" id="ccPaneGithub" role="tabpanel">
                <div class="cc-section">
                  <h6 class="cc-section-title">Authentication Method</h6>
                  <div class="cc-radio-group">
                    <label class="cc-radio-label">
                      <input type="radio" name="ghAuthMethod" value="gh-cli" checked>
                      <span class="cc-radio-text">
                        <strong>GitHub CLI (gh)</strong>
                        <small>Use existing gh CLI authentication</small>
                      </span>
                    </label>
                    <label class="cc-radio-label">
                      <input type="radio" name="ghAuthMethod" value="token">
                      <span class="cc-radio-text">
                        <strong>Personal Access Token</strong>
                        <small>Use a GitHub PAT with repo scope</small>
                      </span>
                    </label>
                  </div>

                  <!-- gh CLI Status -->
                  <div id="ccGhCliSection" class="cc-auth-section">
                    <div class="cc-status-row">
                      <span class="cc-label">Status:</span>
                      <span id="ccGhCliStatus" class="cc-status">
                        <i class="fal fa-spinner fa-spin"></i> Checking...
                      </span>
                    </div>
                  </div>

                  <!-- Token Input -->
                  <div id="ccGhTokenSection" class="cc-auth-section" style="display: none;">
                    <div class="form-group">
                      <label class="cc-label">Personal Access Token</label>
                      <input type="password" class="form-control form-control-sm" id="ccGithubToken" placeholder="ghp_xxxxxxxxxxxx">
                      <small class="form-text text-muted">Token needs <code>repo</code> scope for accessing issues and workflows</small>
                    </div>
                  </div>
                </div>

                <div class="cc-section">
                  <h6 class="cc-section-title">Watched Repositories</h6>
                  <p class="cc-section-desc">Select local git repositories to watch for GitHub issues and PRs.</p>
                  <div class="cc-input-group">
                    <input type="text" class="form-control form-control-sm" id="ccGithubRepoInput" placeholder="owner/repo or browse for local repo" readonly>
                    <button type="button" class="btn btn-sm btn-outline-primary" id="ccBrowseRepoBtn">
                      <i class="fal fa-folder-open"></i> Browse
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-primary" id="ccAddGithubRepoBtn">
                      <i class="fal fa-plus"></i> Add
                    </button>
                  </div>
                  <div id="ccGithubReposList" class="cc-repos-list">
                    <div class="cc-empty-list">No repositories added</div>
                  </div>
                </div>
              </div>

              <!-- Linear Tab -->
              <div class="tab-pane fade" id="ccPaneLinear" role="tabpanel">
                <div class="cc-section">
                  <h6 class="cc-section-title">Authentication</h6>
                  <div class="form-group">
                    <label class="cc-label">API Key</label>
                    <input type="password" class="form-control form-control-sm" id="ccLinearToken" placeholder="lin_api_xxxxxxxxxxxx">
                    <small class="form-text text-muted">Generate an API key at <a href="https://linear.app/settings/account/security" target="_blank" class="text-info">linear.app/settings/account/security</a></small>
                  </div>
                </div>

                <div class="cc-section">
                  <h6 class="cc-section-title">Watched Teams</h6>
                  <button type="button" class="btn btn-sm btn-outline-primary mb-2" id="ccLoadLinearProjectsBtn">
                    <i class="fal fa-sync-alt"></i> Load Teams
                  </button>
                  <div id="ccLinearProjectsList" class="cc-checkbox-list">
                    <div class="cc-empty-list">Enter API key and click Load Teams</div>
                  </div>
                </div>
              </div>

              <!-- Sentry Tab -->
              <div class="tab-pane fade" id="ccPaneSentry" role="tabpanel">
                <div class="cc-section">
                  <h6 class="cc-section-title">Authentication</h6>
                  <div class="form-group">
                    <label class="cc-label">Auth Token</label>
                    <input type="password" class="form-control form-control-sm" id="ccSentryToken" placeholder="sntrys_xxxxxxxxxxxx">
                    <small class="form-text text-muted">Generate a token at <a href="https://sentry.io/settings/auth-tokens/" target="_blank" class="text-info">sentry.io/settings/auth-tokens</a></small>
                  </div>
                </div>

                <div class="cc-section">
                  <h6 class="cc-section-title">Organization</h6>
                  <div class="cc-input-group">
                    <select class="form-control form-control-sm" id="ccSentryOrg">
                      <option value="">Select an organization...</option>
                    </select>
                    <button type="button" class="btn btn-sm btn-outline-primary" id="ccLoadSentryOrgsBtn">
                      <i class="fal fa-sync-alt"></i> Load Organizations
                    </button>
                  </div>
                </div>

                <div class="cc-section">
                  <h6 class="cc-section-title">Watched Projects</h6>
                  <div id="ccSentryProjectsList" class="cc-checkbox-list">
                    <div class="cc-empty-list">Select an organization to load projects</div>
                  </div>
                </div>
              </div>

              <!-- General Tab -->
              <div class="tab-pane fade" id="ccPaneGeneral" role="tabpanel">
                <div class="cc-section">
                  <h6 class="cc-section-title">Command Center</h6>
                  <div class="cc-toggle-row">
                    <label class="cc-toggle-label">
                      <span class="cc-toggle-text">Enable Command Center</span>
                      <input type="checkbox" id="ccEnabledToggle" checked>
                      <span class="cc-toggle-slider"></span>
                    </label>
                  </div>
                </div>

                <div class="cc-section">
                  <h6 class="cc-section-title">Auto-Refresh Interval</h6>
                  <div class="cc-slider-row">
                    <input type="range" class="cc-slider" id="ccRefreshInterval" min="1" max="60" value="15">
                    <span class="cc-slider-value" id="ccRefreshIntervalValue">15 min</span>
                  </div>
                  <small class="form-text text-muted">How often to refresh data from integrations</small>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-sm btn-secondary" id="ccConfigCancelBtn" data-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-sm btn-primary" id="ccConfigSaveBtn">
              <i class="fal fa-save"></i> Save
            </button>
          </div>
        </div>
      </div>
    </div>

    <!--Universal Footer-->
    <footer class="footer">
      <div class="container-fluid">
        <div class="row">
          <div class="col">
            <h6 class="footer-text">
              Status:
              <span id="statusMessage" class="green-text">Connected</span>
            </h6>
          </div>
          <div class="col text-right">
            <h6 class="footer-text">
              <div id="note" class="version-notes">Phantom</div>
            </h6>
          </div>
        </div>
      </div>
    </footer>

    <!-- Update Toast Notification -->
    <div id="update-toast" class="update-toast hidden">
      <div class="update-toast-content">
        <div class="update-toast-icon">
          <i class="fas fa-arrow-circle-up"></i>
        </div>
        <div class="update-toast-text">
          <div class="update-toast-title">Update Available</div>
          <div class="update-toast-version">Version <span id="update-version">0.0.0</span> ready</div>
        </div>
        <div class="update-toast-actions">
          <button id="update-install-btn" class="update-btn-install">Install</button>
          <button id="update-dismiss-btn" class="update-btn-dismiss"><i class="fal fa-times"></i></button>
        </div>
      </div>
      <div id="update-progress-bar" class="update-progress-bar hidden">
        <div id="update-progress-fill" class="update-progress-fill"></div>
      </div>
    </div>

    <script src="js/gui.js?v=1.0.3.10"></script>
    <!-- Mock Electron layer for browser compatibility -->
    <script src="js/tauri-bridge.js?v=1.0.3.10"></script>
    <!-- Slash command autocomplete -->
    <script src="js/slash-commands-data.js?v=1.0.3.10"></script>
    <script src="js/slash-commands.js?v=1.0.3.10"></script>
    <script src="js/custom-dropdown.js?v=1.0.3.10"></script>
    <script src="js/review.js?v=1.0.3.10"></script>
    <script src="js/command-center.js?v=1.0.3.10"></script>
    <script src="js/command-center-config.js?v=1.0.3.10"></script>
    <script src="js/vendor/marked-17.0.1.min.js?v=1.0.3.10"></script>
    <script src="js/meeting-notes.js?v=1.0.3.10"></script>
    <script src="js/application.js?v=1.0.3.10"></script>
    <script src="js/task-scheduler.js?v=1.0.3.10"></script>

    <script src="js/vendor/jquery.color-2.1.2.min.js?v=1.0.3.10"></script>

    <script src="js/vendor/popper.min.js?v=1.0.3.10"></script>
    <script src="js/vendor/bootstrap.min.js?v=1.0.3.10"></script>
    <script>
      // Window controls via tauri-bridge
      $("#close-icon").click(async () => {
        if (!window.tauriBridge || !window.tauriBridge.remote) return;
        try {
          if (typeof window.flushPendingSettingsEdits === "function") {
            await window.flushPendingSettingsEdits();
          }
        } catch (err) {
          console.warn("[Harness] Failed to flush pending settings before close", err);
        }
        window.tauriBridge.remote.getCurrentWindow().close();
      });

      $("#minimize-icon").click(() => {
        if (window.tauriBridge && window.tauriBridge.remote) {
          window.tauriBridge.remote.getCurrentWindow().minimize();
        }
      });

      // Window dragging for custom titlebar
      $(".draggable").on("mousedown", function (e) {
        // Don't drag if clicking on interactive elements
        if (
          $(e.target).closest(".nav-item, .nav-link, button, a, input, select")
            .length
        ) {
          return;
        }
        if (window.tauriBridge && window.tauriBridge.remote) {
          window.tauriBridge.remote.getCurrentWindow().startDragging();
        }
      });
    </script>
  </body>
</html>
